<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>rfidsim: node.hpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
  </ul></div>
<h1>node.hpp</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00002"></a>00002 <span class="preprocessor">#ifndef NODE_H</span>
<a name="l00003"></a>00003 <span class="preprocessor"></span><span class="preprocessor">#define NODE_H</span>
<a name="l00004"></a>00004 <span class="preprocessor"></span>
<a name="l00005"></a>00005 <span class="preprocessor">#include &lt;limits&gt;</span>
<a name="l00006"></a>00006 <span class="preprocessor">#include &lt;iostream&gt;</span>
<a name="l00007"></a>00007 <span class="preprocessor">#include &lt;sstream&gt;</span>
<a name="l00008"></a>00008 <span class="keyword">using namespace </span>std;
<a name="l00009"></a>00009 <span class="preprocessor">#include &lt;boost/shared_ptr.hpp&gt;</span>
<a name="l00010"></a>00010 <span class="preprocessor">#include &lt;boost/enable_shared_from_this.hpp&gt;</span>
<a name="l00011"></a>00011 
<a name="l00012"></a>00012 <span class="preprocessor">#include "sim_time.hpp"</span>
<a name="l00013"></a>00013 <span class="preprocessor">#include "communication_layer.hpp"</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include "location.hpp"</span>
<a name="l00015"></a>00015 
<a name="l00016"></a>00016 <span class="keyword">class </span><a class="code" href="classEvent.html">Event</a>;
<a name="l00017"></a>00017 <span class="keyword">typedef</span> boost::shared_ptr&lt;Event&gt; <a class="code" href="classEvent.html#1a82a86bd9945cb8e97b7026dcafc75e">EventPtr</a>;
<a name="l00018"></a>00018 
<a name="l00020"></a>00020 <span class="comment">// Node Id Class</span>
<a name="l00022"></a>00022 <span class="comment"></span>
<a name="l00027"></a><a class="code" href="classNodeId.html">00027</a> <span class="keyword">class </span><a class="code" href="classNodeId.html">NodeId</a>
<a name="l00028"></a>00028 {
<a name="l00034"></a>00034 <span class="keyword">public</span>:
<a name="l00035"></a>00035 
<a name="l00039"></a><a class="code" href="classNodeId.html#098f076be9769fb7a8d5b4e6c58ed1af">00039</a>    <a class="code" href="classNodeId.html#098f076be9769fb7a8d5b4e6c58ed1af">NodeId</a>(<a class="code" href="utility_8hpp.html#b393a696e0318c8ab53ae2a1592e3770">t_uint</a> numericValue)
<a name="l00040"></a>00040       : <a class="code" href="classNodeId.html#91002284aaeaac3868e419344e459f96">m_numericValue</a>(numericValue) 
<a name="l00041"></a>00041    { }
<a name="l00042"></a>00042 
<a name="l00051"></a><a class="code" href="classNodeId.html#fcc86164845ea39dfe838ffbfc9c020f">00051</a>    <a class="code" href="classNodeId.html#098f076be9769fb7a8d5b4e6c58ed1af">NodeId</a>(<span class="keyword">const</span> <a class="code" href="utility_8hpp.html#0a4a98abf39e826ef67f8c547f3c9be5">t_uchar</a>* byteArray, <a class="code" href="utility_8hpp.html#b393a696e0318c8ab53ae2a1592e3770">t_uint</a> byteCount)
<a name="l00052"></a>00052    {
<a name="l00053"></a>00053       <a class="code" href="classNodeId.html#91002284aaeaac3868e419344e459f96">m_numericValue</a> = 0;
<a name="l00054"></a>00054       <span class="keywordflow">for</span>(<a class="code" href="utility_8hpp.html#b393a696e0318c8ab53ae2a1592e3770">t_uint</a> i = 0; i &lt; byteCount; i++) {
<a name="l00055"></a>00055          <span class="keywordflow">if</span>(i &gt; <span class="keyword">sizeof</span>(<a class="code" href="utility_8hpp.html#b393a696e0318c8ab53ae2a1592e3770">t_uint</a>))
<a name="l00056"></a>00056             assert(byteArray[i] == 0);
<a name="l00057"></a>00057          <a class="code" href="classNodeId.html#91002284aaeaac3868e419344e459f96">m_numericValue</a> += (byteArray[i] &lt;&lt; (8 * i));
<a name="l00058"></a>00058       }
<a name="l00059"></a>00059    }
<a name="l00060"></a>00060 
<a name="l00062"></a><a class="code" href="classNodeId.html#b9cd5fb8a7dad73afca44e06f84a9c5c">00062</a>    <span class="keyword">virtual</span> <a class="code" href="classNodeId.html#b9cd5fb8a7dad73afca44e06f84a9c5c">~NodeId</a>() { }
<a name="l00063"></a>00063 
<a name="l00071"></a><a class="code" href="classNodeId.html#034ffeef37855802c66d1c9c52ad7074">00071</a>    <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classNodeId.html#034ffeef37855802c66d1c9c52ad7074">writeToByteArray</a>(<a class="code" href="utility_8hpp.html#0a4a98abf39e826ef67f8c547f3c9be5">t_uchar</a>* byteArray, 
<a name="l00072"></a>00072       <a class="code" href="utility_8hpp.html#b393a696e0318c8ab53ae2a1592e3770">t_uint</a> byteCount)<span class="keyword"> const</span>
<a name="l00073"></a>00073 <span class="keyword">   </span>{
<a name="l00074"></a>00074       <a class="code" href="utility_8hpp.html#b393a696e0318c8ab53ae2a1592e3770">t_uint</a> <span class="keywordtype">id</span> = <a class="code" href="classNodeId.html#390c660d929ebe5801a7cc04ea4aa7a6">getNumericValue</a>();
<a name="l00075"></a>00075       assert(<span class="keyword">sizeof</span>(<a class="code" href="utility_8hpp.html#b393a696e0318c8ab53ae2a1592e3770">t_uint</a>) &lt;= byteCount);
<a name="l00076"></a>00076       <span class="comment">// Reset the data to zero.</span>
<a name="l00077"></a>00077       fill(byteArray, &amp;byteArray[byteCount], 0);
<a name="l00078"></a>00078       t_uint i = 0;
<a name="l00079"></a>00079       <span class="keywordflow">while</span>(<span class="keywordtype">id</span> &gt; 0) {
<a name="l00080"></a>00080          assert(i &lt; byteCount);
<a name="l00081"></a>00081          byteArray[i++] = <span class="keywordtype">id</span> &amp; 0xFF;
<a name="l00082"></a>00082          <span class="keywordtype">id</span> &gt;&gt;= 8;
<a name="l00083"></a>00083       }
<a name="l00084"></a>00084    }
<a name="l00085"></a>00085 
<a name="l00091"></a><a class="code" href="classNodeId.html#51e12a62df26c56ffcbab9f96ea5b07c">00091</a>    <span class="keyword">static</span> <span class="keyword">inline</span> <a class="code" href="utility_8hpp.html#b393a696e0318c8ab53ae2a1592e3770">t_uint</a> <a class="code" href="classNodeId.html#51e12a62df26c56ffcbab9f96ea5b07c">broadcastDestination</a>()
<a name="l00092"></a>00092    {
<a name="l00093"></a>00093       <span class="keywordflow">return</span> numeric_limits&lt;t_uint&gt;::max();
<a name="l00094"></a>00094    }
<a name="l00095"></a>00095 
<a name="l00100"></a><a class="code" href="classNodeId.html#544ad375b4440d8c20e8c7ef48fe8d25">00100</a>    <span class="keyword">virtual</span> string <a class="code" href="classNodeId.html#544ad375b4440d8c20e8c7ef48fe8d25">getStringValue</a>()<span class="keyword"> const</span>
<a name="l00101"></a>00101 <span class="keyword">   </span>{
<a name="l00102"></a>00102       ostringstream streamValue;
<a name="l00103"></a>00103       <span class="keywordflow">if</span>(<a class="code" href="classNodeId.html#91002284aaeaac3868e419344e459f96">m_numericValue</a> == <a class="code" href="classNodeId.html#51e12a62df26c56ffcbab9f96ea5b07c">broadcastDestination</a>())
<a name="l00104"></a>00104          streamValue &lt;&lt; <span class="stringliteral">"BROADCAST"</span>;
<a name="l00105"></a>00105       <span class="keywordflow">else</span>
<a name="l00106"></a>00106          streamValue &lt;&lt; <a class="code" href="classNodeId.html#91002284aaeaac3868e419344e459f96">m_numericValue</a>;
<a name="l00107"></a>00107       <span class="keywordflow">return</span> streamValue.str();
<a name="l00108"></a>00108    }
<a name="l00109"></a>00109 
<a name="l00114"></a><a class="code" href="classNodeId.html#390c660d929ebe5801a7cc04ea4aa7a6">00114</a>    <span class="keyword">virtual</span> <a class="code" href="utility_8hpp.html#b393a696e0318c8ab53ae2a1592e3770">t_uint</a> <a class="code" href="classNodeId.html#390c660d929ebe5801a7cc04ea4aa7a6">getNumericValue</a>()<span class="keyword"> const</span>
<a name="l00115"></a>00115 <span class="keyword">   </span>{
<a name="l00116"></a>00116       <span class="keywordflow">return</span> <a class="code" href="classNodeId.html#91002284aaeaac3868e419344e459f96">m_numericValue</a>;
<a name="l00117"></a>00117    }
<a name="l00118"></a>00118 
<a name="l00123"></a><a class="code" href="classNodeId.html#8ee78492b5a20d53cd141dd567183008">00123</a>    <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classNodeId.html#8ee78492b5a20d53cd141dd567183008">operator== </a>(<span class="keyword">const</span> <a class="code" href="classNodeId.html">NodeId</a>&amp; rhs)<span class="keyword"> const</span>
<a name="l00124"></a>00124 <span class="keyword">   </span>{
<a name="l00125"></a>00125       <span class="keywordflow">return</span> <a class="code" href="classNodeId.html#91002284aaeaac3868e419344e459f96">m_numericValue</a> == rhs.<a class="code" href="classNodeId.html#91002284aaeaac3868e419344e459f96">m_numericValue</a>;
<a name="l00126"></a>00126    }
<a name="l00127"></a>00127 
<a name="l00133"></a><a class="code" href="classNodeId.html#9bfcc3f4ee45c9edfc71d730a6749b88">00133</a>    <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classNodeId.html#9bfcc3f4ee45c9edfc71d730a6749b88">operator&lt; </a>(<span class="keyword">const</span> <a class="code" href="classNodeId.html">NodeId</a>&amp; rhs)<span class="keyword"> const</span>
<a name="l00134"></a>00134 <span class="keyword">   </span>{
<a name="l00135"></a>00135       <span class="keywordflow">return</span> <a class="code" href="classNodeId.html#91002284aaeaac3868e419344e459f96">m_numericValue</a> &lt; rhs.<a class="code" href="classNodeId.html#91002284aaeaac3868e419344e459f96">m_numericValue</a>;
<a name="l00136"></a>00136    }
<a name="l00137"></a>00137 
<a name="l00138"></a>00138 <span class="keyword">protected</span>:
<a name="l00139"></a>00139 
<a name="l00143"></a><a class="code" href="classNodeId.html#91002284aaeaac3868e419344e459f96">00143</a>    <a class="code" href="utility_8hpp.html#b393a696e0318c8ab53ae2a1592e3770">t_uint</a> <a class="code" href="classNodeId.html#91002284aaeaac3868e419344e459f96">m_numericValue</a>;
<a name="l00144"></a>00144 
<a name="l00145"></a>00145 };
<a name="l00146"></a>00146 
<a name="l00153"></a><a class="code" href="classNode.html">00153</a> <span class="keyword">class </span><a class="code" href="classNode.html">Node</a> : boost::noncopyable,
<a name="l00154"></a>00154    <span class="keyword">public</span> boost::enable_shared_from_this&lt;Node&gt; {
<a name="l00155"></a>00155    <span class="comment">// NOTE: For now, we will make this class noncopyable</span>
<a name="l00156"></a>00156    <span class="comment">// since a copyable version would require maintaining</span>
<a name="l00157"></a>00157    <span class="comment">// pointers to all added layers and copying each one</span>
<a name="l00158"></a>00158    <span class="comment">// when necessary.</span>
<a name="l00159"></a>00159 <span class="keyword">public</span>:
<a name="l00161"></a><a class="code" href="classNode.html#715e58098d27b93b903b5c7cacb402f8">00161</a>    <span class="keyword">typedef</span> boost::shared_ptr&lt;Node&gt; <a class="code" href="classNode.html#715e58098d27b93b903b5c7cacb402f8">NodePtr</a>;
<a name="l00162"></a>00162 
<a name="l00164"></a>00164    <span class="keyword">virtual</span> <a class="code" href="classNode.html#a0840c3cb5c7159be6d992adecd2097c">~Node</a>();
<a name="l00165"></a>00165 
<a name="l00172"></a>00172    <span class="keyword">static</span> <span class="keyword">inline</span> <a class="code" href="classNode.html#715e58098d27b93b903b5c7cacb402f8">NodePtr</a> <a class="code" href="classNode.html#41862de133b24c83c735a3690f03ca5c">create</a>(<span class="keyword">const</span> <a class="code" href="classLocation.html">Location</a>&amp; location, 
<a name="l00173"></a>00173       <span class="keyword">const</span> <a class="code" href="classNodeId.html">NodeId</a>&amp; nodeId);
<a name="l00174"></a>00174 
<a name="l00179"></a>00179    <span class="keyword">inline</span> <a class="code" href="classLocation.html">Location</a> <a class="code" href="classNode.html#88b1184c928535e14a3eca586ae0d13b">getLocation</a>() <span class="keyword">const</span>;
<a name="l00180"></a>00180 
<a name="l00185"></a>00185    <span class="keyword">inline</span> <a class="code" href="classNodeId.html">NodeId</a> <a class="code" href="classNode.html#482b556a7212d106285fad0836661391">getNodeId</a>() <span class="keyword">const</span>;
<a name="l00186"></a>00186 
<a name="l00193"></a>00193    <a class="code" href="classSimTime.html">SimTime</a> <a class="code" href="classNode.html#598082674e370e351178454d4ab4ed9e">currentTime</a>() <span class="keyword">const</span>;
<a name="l00194"></a>00194 
<a name="l00203"></a>00203    <span class="keywordtype">bool</span> <a class="code" href="classNode.html#b9be0ba6748b1e8c55e86478a161be9b">scheduleEvent</a>(EventPtr eventToSchedule,
<a name="l00204"></a>00204       <span class="keyword">const</span> <a class="code" href="classSimTime.html">SimTime</a>&amp; eventDelay);
<a name="l00205"></a>00205 
<a name="l00212"></a>00212    <span class="keywordtype">bool</span> <a class="code" href="classNode.html#8d5f0b62e87d0736b341c6f1175ebc03">cancelEvent</a>(EventPtr eventToCancel);
<a name="l00213"></a>00213 
<a name="l00214"></a>00214 <span class="keyword">protected</span>:
<a name="l00215"></a>00215 
<a name="l00219"></a>00219    <a class="code" href="classNode.html#87e6c22c6679104e752b2507f0dee143">Node</a>(<span class="keyword">const</span> <a class="code" href="classLocation.html">Location</a>&amp; location, <span class="keyword">const</span> <a class="code" href="classNodeId.html">NodeId</a>&amp; nodeId);
<a name="l00220"></a>00220 
<a name="l00221"></a>00221 <span class="keyword">private</span>:
<a name="l00222"></a>00222 
<a name="l00225"></a>00225    <a class="code" href="classLocation.html">Location</a> m_location;
<a name="l00226"></a>00226 
<a name="l00229"></a>00229    <a class="code" href="classNodeId.html">NodeId</a> m_nodeId;
<a name="l00230"></a>00230 
<a name="l00231"></a>00231 };
<a name="l00232"></a>00232 <span class="keyword">typedef</span> boost::shared_ptr&lt;Node&gt; NodePtr;
<a name="l00233"></a>00233 
<a name="l00235"></a>00235 <span class="comment">// Inline Functions</span>
<a name="l00237"></a>00237 <span class="comment"></span>
<a name="l00238"></a><a class="code" href="classNode.html#41862de133b24c83c735a3690f03ca5c">00238</a> <span class="keyword">inline</span> NodePtr <a class="code" href="classNode.html#41862de133b24c83c735a3690f03ca5c">Node::create</a>(<span class="keyword">const</span> <a class="code" href="classLocation.html">Location</a>&amp; location, 
<a name="l00239"></a>00239    <span class="keyword">const</span> <a class="code" href="classNodeId.html">NodeId</a>&amp; nodeId)
<a name="l00240"></a>00240 {
<a name="l00241"></a>00241    <a class="code" href="classNode.html#715e58098d27b93b903b5c7cacb402f8">NodePtr</a> p(<span class="keyword">new</span> <a class="code" href="classNode.html#87e6c22c6679104e752b2507f0dee143">Node</a>(location, nodeId));
<a name="l00242"></a>00242    <span class="keywordflow">return</span> p;
<a name="l00243"></a>00243 }
<a name="l00244"></a>00244 
<a name="l00245"></a><a class="code" href="classNode.html#88b1184c928535e14a3eca586ae0d13b">00245</a> <span class="keyword">inline</span> <a class="code" href="classLocation.html">Location</a> <a class="code" href="classNode.html#88b1184c928535e14a3eca586ae0d13b">Node::getLocation</a>()<span class="keyword"> const</span>
<a name="l00246"></a>00246 <span class="keyword"></span>{
<a name="l00247"></a>00247    <span class="keywordflow">return</span> m_location;
<a name="l00248"></a>00248 }
<a name="l00249"></a>00249 
<a name="l00250"></a><a class="code" href="classNode.html#482b556a7212d106285fad0836661391">00250</a> <span class="keyword">inline</span> <a class="code" href="classNodeId.html">NodeId</a> <a class="code" href="classNode.html#482b556a7212d106285fad0836661391">Node::getNodeId</a>()<span class="keyword"> const</span>
<a name="l00251"></a>00251 <span class="keyword"></span>{
<a name="l00252"></a>00252    <span class="keywordflow">return</span> m_nodeId;
<a name="l00253"></a>00253 }
<a name="l00254"></a>00254 
<a name="l00256"></a>00256 <span class="comment">// Overloaded Operators</span>
<a name="l00258"></a>00258 <span class="comment"></span>
<a name="l00259"></a>00259 <span class="keyword">inline</span> ostream&amp; operator&lt;&lt; (ostream&amp; s, <span class="keyword">const</span> <a class="code" href="classNode.html">Node</a>&amp; node)
<a name="l00260"></a>00260 {
<a name="l00261"></a>00261    <span class="keywordflow">return</span> s&lt;&lt; <span class="stringliteral">"Node state (pointer="</span> &lt;&lt; &amp;node &lt;&lt; <span class="stringliteral">")"</span>;
<a name="l00262"></a>00262 }
<a name="l00263"></a>00263 
<a name="l00264"></a>00264 <span class="keyword">inline</span> ostream&amp; operator&lt;&lt; (ostream&amp; s, <span class="keyword">const</span> <a class="code" href="classNodeId.html">NodeId</a>&amp; nodeId)
<a name="l00265"></a>00265 {
<a name="l00266"></a>00266    <span class="keywordflow">return</span> s&lt;&lt; nodeId.<a class="code" href="classNodeId.html#544ad375b4440d8c20e8c7ef48fe8d25">getStringValue</a>();
<a name="l00267"></a>00267 }
<a name="l00268"></a>00268 
<a name="l00269"></a>00269 <span class="preprocessor">#endif // NODE_H</span>
<a name="l00270"></a>00270 <span class="preprocessor"></span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Dec 12 17:04:38 2006 for rfidsim by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
