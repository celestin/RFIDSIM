<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>rfidsim: communication_layer.hpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
  </ul></div>
<h1>communication_layer.hpp</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00002"></a>00002 <span class="preprocessor">#ifndef COMMUNICATION_LAYER_H</span>
<a name="l00003"></a>00003 <span class="preprocessor"></span><span class="preprocessor">#define COMMUNICATION_LAYER_H</span>
<a name="l00004"></a>00004 <span class="preprocessor"></span>
<a name="l00005"></a>00005 <span class="preprocessor">#include &lt;vector&gt;</span>
<a name="l00006"></a>00006 <span class="preprocessor">#include &lt;list&gt;</span>
<a name="l00007"></a>00007 <span class="preprocessor">#include &lt;iostream&gt;</span>
<a name="l00008"></a>00008 <span class="keyword">using namespace </span>std;
<a name="l00009"></a>00009 <span class="preprocessor">#include &lt;boost/shared_ptr.hpp&gt;</span>
<a name="l00010"></a>00010 <span class="preprocessor">#include &lt;boost/enable_shared_from_this.hpp&gt;</span>
<a name="l00011"></a>00011 <span class="preprocessor">#include &lt;boost/utility.hpp&gt;</span>
<a name="l00012"></a>00012 
<a name="l00013"></a>00013 <span class="preprocessor">#include "event.hpp"</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include "<a class="code" href="utility_8hpp.html">utility.hpp</a>"</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include "sim_time.hpp"</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include "simulation_end_listener.hpp"</span>
<a name="l00017"></a>00017 
<a name="l00018"></a>00018 <span class="keyword">class </span><a class="code" href="classNode.html">Node</a>;
<a name="l00019"></a>00019 <span class="keyword">typedef</span> boost::shared_ptr&lt;Node&gt; <a class="code" href="classNode.html#715e58098d27b93b903b5c7cacb402f8">NodePtr</a>;
<a name="l00020"></a>00020 <span class="keyword">typedef</span> boost::shared_ptr&lt;Node const&gt; ConstNodePtr;
<a name="l00021"></a>00021 <span class="keyword">class </span><a class="code" href="classNodeId.html">NodeId</a>;
<a name="l00022"></a>00022 <span class="keyword">class </span><a class="code" href="classPacket.html">Packet</a>;
<a name="l00023"></a>00023 <span class="keyword">typedef</span> boost::shared_ptr&lt;Packet&gt; <a class="code" href="classPacket.html#ae493852bf01dc874628c78d157927e3">PacketPtr</a>;
<a name="l00024"></a>00024 
<a name="l00035"></a><a class="code" href="classCommunicationLayer.html">00035</a> <span class="keyword">class </span><a class="code" href="classCommunicationLayer.html">CommunicationLayer</a> : 
<a name="l00036"></a>00036    <span class="keyword">public</span> <a class="code" href="classSimulationEndListener.html">SimulationEndListener</a>,
<a name="l00037"></a>00037    boost::noncopyable, 
<a name="l00038"></a>00038    <span class="keyword">public</span> boost::enable_shared_from_this&lt;CommunicationLayer&gt; {
<a name="l00039"></a>00039    <span class="comment">// Only node can call setNode()</span>
<a name="l00040"></a><a class="code" href="classCommunicationLayer.html#6db9d28bd448a131448276ee03de1e6d">00040</a>    <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classNode.html">Node</a>;
<a name="l00041"></a><a class="code" href="classCommunicationLayer.html#505b310ab9d3b3e2f5667729b3d4ae55">00041</a>    <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classLayerRecvEvent.html">LayerRecvEvent</a>;
<a name="l00042"></a>00042 <span class="keyword">public</span>:
<a name="l00044"></a><a class="code" href="classCommunicationLayer.html#81a0d144a97da5cd90fd3b2ec54fcdc6">00044</a>    <span class="keyword">typedef</span> boost::shared_ptr&lt;CommunicationLayer&gt; <a class="code" href="classCommunicationLayer.html#81a0d144a97da5cd90fd3b2ec54fcdc6">CommunicationLayerPtr</a>;
<a name="l00046"></a>00046    <span class="keyword">typedef</span> boost::shared_ptr&lt;SimulationEndListener&gt; 
<a name="l00047"></a><a class="code" href="classCommunicationLayer.html#c193c9f1b512787509359eb87ae745c5">00047</a>       <a class="code" href="classCommunicationLayer.html#c193c9f1b512787509359eb87ae745c5">SimulationEndListenerPtr</a>;
<a name="l00048"></a>00048 
<a name="l00054"></a><a class="code" href="classCommunicationLayer.html#5076652ba2dc2a5f8c0b912baa2e9127">00054</a>    <span class="keyword">enum</span> <a class="code" href="classCommunicationLayer.html#5076652ba2dc2a5f8c0b912baa2e9127">Directions</a> { 
<a name="l00055"></a>00055       <a class="code" href="classCommunicationLayer.html#5076652ba2dc2a5f8c0b912baa2e9127e110d3be994645ed51372e4be52ff311">Directions_Lower</a>, 
<a name="l00056"></a><a class="code" href="classCommunicationLayer.html#5076652ba2dc2a5f8c0b912baa2e91272ee130c439543c6b244d33b8745c6741">00056</a>       <a class="code" href="classCommunicationLayer.html#5076652ba2dc2a5f8c0b912baa2e91272ee130c439543c6b244d33b8745c6741">Directions_Upper</a>  
<a name="l00057"></a>00057    };
<a name="l00058"></a>00058 
<a name="l00063"></a><a class="code" href="classCommunicationLayer.html#4cbb01eeaddc7b36151fe34379aa56e6">00063</a>    <span class="keyword">enum</span> <a class="code" href="classCommunicationLayer.html#4cbb01eeaddc7b36151fe34379aa56e6">Types</a> {
<a name="l00064"></a>00064       <a class="code" href="classCommunicationLayer.html#4cbb01eeaddc7b36151fe34379aa56e642f157e36bc169d12ccc314cbbca49a9">Types_Physical</a>, 
<a name="l00065"></a>00065       <a class="code" href="classCommunicationLayer.html#4cbb01eeaddc7b36151fe34379aa56e6f18b7936d0f2478bd354224444cb993f">Types_Link</a>, 
<a name="l00066"></a>00066       <a class="code" href="classCommunicationLayer.html#4cbb01eeaddc7b36151fe34379aa56e620a9f99157d61bce3a7d5782ca467150">Types_Network</a>, 
<a name="l00067"></a>00067       <a class="code" href="classCommunicationLayer.html#4cbb01eeaddc7b36151fe34379aa56e6ef54f2c3aeee1b552ef0d77b1cf964d4">Types_Transport</a>, 
<a name="l00068"></a><a class="code" href="classCommunicationLayer.html#4cbb01eeaddc7b36151fe34379aa56e6283a1bc99f61ba8edc4f587c36becf7f">00068</a>       <a class="code" href="classCommunicationLayer.html#4cbb01eeaddc7b36151fe34379aa56e6283a1bc99f61ba8edc4f587c36becf7f">Types_Application</a> 
<a name="l00069"></a>00069    };
<a name="l00070"></a>00070 
<a name="l00074"></a>00074    <span class="keyword">virtual</span> <a class="code" href="classCommunicationLayer.html#667f64b773558eed05caf25d9151ee18">~CommunicationLayer</a>();
<a name="l00075"></a>00075 
<a name="l00082"></a>00082    <span class="keyword">virtual</span> <a class="code" href="classCommunicationLayer.html#c193c9f1b512787509359eb87ae745c5">SimulationEndListenerPtr</a> <a class="code" href="classCommunicationLayer.html#4a1f85319b7945b9b2c481c026bc69a8">thisSimulationEndListener</a>() = 0;
<a name="l00083"></a>00083 
<a name="l00092"></a>00092    <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classCommunicationLayer.html#e8d7522ba2ec2991d7302fe60b0ecbf0">insertLowerLayer</a>(<a class="code" href="classCommunicationLayer.html#81a0d144a97da5cd90fd3b2ec54fcdc6">CommunicationLayerPtr</a> layerToInsert);
<a name="l00093"></a>00093 
<a name="l00099"></a>00099    <span class="keyword">inline</span> <a class="code" href="utility_8hpp.html#b393a696e0318c8ab53ae2a1592e3770">t_uint</a> <a class="code" href="classCommunicationLayer.html#f99fc2c30b2e3f08d02d7c60a6b85927">numberOfLayers</a>(<a class="code" href="classCommunicationLayer.html#5076652ba2dc2a5f8c0b912baa2e9127">Directions</a> direction) <span class="keyword">const</span>;
<a name="l00100"></a>00100 
<a name="l00108"></a>00108    <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classCommunicationLayer.html#1c49b67142c7ce48284d2cceed4353fb">setDefaultLayer</a>(<a class="code" href="classCommunicationLayer.html#5076652ba2dc2a5f8c0b912baa2e9127">Directions</a> direction, <a class="code" href="utility_8hpp.html#b393a696e0318c8ab53ae2a1592e3770">t_uint</a> newDefaultIdx);
<a name="l00109"></a>00109 
<a name="l00115"></a>00115    <span class="keyword">inline</span> <a class="code" href="utility_8hpp.html#b393a696e0318c8ab53ae2a1592e3770">t_uint</a> <a class="code" href="classCommunicationLayer.html#a8660c7360286ab21093f1f0e75b09d9">getDefaultLayer</a>(<a class="code" href="classCommunicationLayer.html#5076652ba2dc2a5f8c0b912baa2e9127">Directions</a> direction) <span class="keyword">const</span>;
<a name="l00116"></a>00116 
<a name="l00123"></a>00123    <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classCommunicationLayer.html#062a1403bdaf80498283039a872b20b1">setLayerDelay</a>(<a class="code" href="classCommunicationLayer.html#5076652ba2dc2a5f8c0b912baa2e9127">Directions</a> direction, <span class="keyword">const</span> <a class="code" href="classSimTime.html">SimTime</a>&amp; delay);
<a name="l00124"></a>00124 
<a name="l00131"></a>00131    <span class="keyword">inline</span> <a class="code" href="classSimTime.html">SimTime</a> <a class="code" href="classCommunicationLayer.html#d068c81501292c66601e900dbe2ca120">getLayerDelay</a>(<a class="code" href="classCommunicationLayer.html#5076652ba2dc2a5f8c0b912baa2e9127">Directions</a> direction) <span class="keyword">const</span>;
<a name="l00132"></a>00132 
<a name="l00139"></a>00139    <span class="keywordtype">bool</span> <a class="code" href="classCommunicationLayer.html#92a648495057eea34fb42ddbce0440bd">sendToQueue</a>(PacketPtr packet);
<a name="l00140"></a>00140 
<a name="l00148"></a>00148    <span class="keywordtype">bool</span> <a class="code" href="classCommunicationLayer.html#92a648495057eea34fb42ddbce0440bd">sendToQueue</a>(PacketPtr packet, <a class="code" href="utility_8hpp.html#b393a696e0318c8ab53ae2a1592e3770">t_uint</a> lowerLayerIdx);
<a name="l00149"></a>00149 
<a name="l00154"></a>00154    <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classCommunicationLayer.html#3cdc193a177fa4728f8b7a0eb73121fa">unblockQueue</a>();
<a name="l00155"></a>00155 
<a name="l00160"></a>00160    <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classCommunicationLayer.html#8e5223a8bba2940517f4e616b5ceb7db">blockQueue</a>();
<a name="l00161"></a>00161 
<a name="l00166"></a>00166    <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classCommunicationLayer.html#dbb99928c467117bd35b1c4b71330ade">getQueueIsBlocked</a>() <span class="keyword">const</span>;
<a name="l00167"></a>00167 
<a name="l00173"></a>00173    <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classCommunicationLayer.html#857d6b46cce18e15099a4eaa7246176a">setMaxQueueLength</a>(<a class="code" href="utility_8hpp.html#b393a696e0318c8ab53ae2a1592e3770">t_uint</a> maxQueueLength);
<a name="l00174"></a>00174 
<a name="l00180"></a>00180    <span class="keyword">inline</span> <a class="code" href="utility_8hpp.html#b393a696e0318c8ab53ae2a1592e3770">t_uint</a> <a class="code" href="classCommunicationLayer.html#1263c7097c8587a490cb90518d4d7585">getMaxQueueLength</a>() <span class="keyword">const</span>;
<a name="l00181"></a>00181 
<a name="l00191"></a>00191    <span class="keywordtype">bool</span> <a class="code" href="classCommunicationLayer.html#85034666eb2f18a65bf4089f9a93fee9">sendToLayer</a>(<a class="code" href="classCommunicationLayer.html#5076652ba2dc2a5f8c0b912baa2e9127">Directions</a> direction, PacketPtr packet);
<a name="l00192"></a>00192 
<a name="l00204"></a>00204    <span class="keywordtype">bool</span> <a class="code" href="classCommunicationLayer.html#85034666eb2f18a65bf4089f9a93fee9">sendToLayer</a>(<a class="code" href="classCommunicationLayer.html#5076652ba2dc2a5f8c0b912baa2e9127">Directions</a> direction, PacketPtr packet, 
<a name="l00205"></a>00205       <a class="code" href="utility_8hpp.html#b393a696e0318c8ab53ae2a1592e3770">t_uint</a> recvingLayerIdx);
<a name="l00206"></a>00206 
<a name="l00214"></a>00214    <span class="keywordtype">bool</span> <a class="code" href="classCommunicationLayer.html#d28fa38cc73236fb7430560459d8d383">sendToAllLayers</a>(<a class="code" href="classCommunicationLayer.html#5076652ba2dc2a5f8c0b912baa2e9127">Directions</a> direction, PacketPtr packet);
<a name="l00215"></a>00215 
<a name="l00225"></a>00225    <span class="keywordtype">bool</span> <a class="code" href="classCommunicationLayer.html#dd3166bab801aacdaafa3e7ba460a216">recvFromLayer</a>(<a class="code" href="classCommunicationLayer.html#5076652ba2dc2a5f8c0b912baa2e9127">Directions</a> direction, PacketPtr packet, 
<a name="l00226"></a>00226       <a class="code" href="classCommunicationLayer.html#81a0d144a97da5cd90fd3b2ec54fcdc6">CommunicationLayerPtr</a> sendingLayer);
<a name="l00227"></a>00227 
<a name="l00240"></a>00240    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="classCommunicationLayer.html#dd3166bab801aacdaafa3e7ba460a216">recvFromLayer</a>(<a class="code" href="classCommunicationLayer.html#5076652ba2dc2a5f8c0b912baa2e9127">Directions</a> direction, PacketPtr packet, 
<a name="l00241"></a>00241       <a class="code" href="utility_8hpp.html#b393a696e0318c8ab53ae2a1592e3770">t_uint</a> sendingLayerIdx);
<a name="l00242"></a>00242 
<a name="l00247"></a>00247    <span class="keyword">virtual</span> <a class="code" href="classCommunicationLayer.html#4cbb01eeaddc7b36151fe34379aa56e6">Types</a> <a class="code" href="classCommunicationLayer.html#d03db488bd723170a093700a58cb3c9e">getLayerType</a>() <span class="keyword">const </span>= 0;
<a name="l00248"></a>00248 
<a name="l00253"></a>00253    <a class="code" href="classNodeId.html">NodeId</a> <a class="code" href="classCommunicationLayer.html#5a5bf986675df016c3aa8817868ed787">getNodeId</a>() <span class="keyword">const</span>;
<a name="l00254"></a>00254 
<a name="l00255"></a>00255 <span class="keyword">protected</span>:
<a name="l00256"></a>00256 
<a name="l00262"></a>00262    <a class="code" href="classCommunicationLayer.html#d24e26b4c193152da4a445af30d0ecc1">CommunicationLayer</a>(NodePtr node);
<a name="l00263"></a>00263 
<a name="l00266"></a><a class="code" href="classCommunicationLayer.html#ab2bcbf24c42ad6054d5920ebf108026">00266</a>    <span class="keywordtype">bool</span> <a class="code" href="classCommunicationLayer.html#ab2bcbf24c42ad6054d5920ebf108026">m_lowerLayerRecvEventPending</a>;
<a name="l00267"></a>00267 
<a name="l00271"></a>00271    <span class="keyword">inline</span> NodePtr <a class="code" href="classCommunicationLayer.html#39c60778d7fb9f62cda84eae80bf0395">getNode</a>() <span class="keyword">const</span>;
<a name="l00272"></a>00272 
<a name="l00277"></a>00277    <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classCommunicationLayer.html#92b821de3192e463f7850bc6626e6f86">queueIsFull</a>() <span class="keyword">const</span>;
<a name="l00278"></a>00278 
<a name="l00282"></a>00282    <span class="keywordtype">void</span> <a class="code" href="classCommunicationLayer.html#5b2fa56571241dad4558136d3587cb8b">blockUpperQueues</a>();
<a name="l00283"></a>00283 
<a name="l00288"></a>00288    <span class="keywordtype">void</span> <a class="code" href="classCommunicationLayer.html#766619acc497c60a27919a7038ce5da7">unblockUpperQueues</a>();
<a name="l00289"></a>00289 
<a name="l00294"></a>00294    <span class="keywordtype">void</span> <a class="code" href="classCommunicationLayer.html#86c3c9f905fa39c1193e1f51a1d24a99">sendFromQueue</a>();
<a name="l00295"></a>00295 
<a name="l00304"></a>00304    <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classCommunicationLayer.html#b1a9429e4031d925ed2f1eea070147ef">setLowerLayerRecvEventPending</a>(<span class="keywordtype">bool</span> isPending);
<a name="l00305"></a>00305 
<a name="l00311"></a>00311    <span class="keywordtype">void</span> <a class="code" href="classCommunicationLayer.html#f03887be4e5b8e06a8a071413d199115">removeLayerData</a>(PacketPtr packet) <span class="keyword">const</span>;
<a name="l00312"></a>00312 
<a name="l00320"></a>00320    <span class="keyword">inline</span> <a class="code" href="classCommunicationLayer.html#81a0d144a97da5cd90fd3b2ec54fcdc6">CommunicationLayerPtr</a> <a class="code" href="classCommunicationLayer.html#7518faba7445c8c61d283575d2962283">getLayer</a>(<a class="code" href="classCommunicationLayer.html#5076652ba2dc2a5f8c0b912baa2e9127">Directions</a> direction, 
<a name="l00321"></a>00321       <a class="code" href="utility_8hpp.html#b393a696e0318c8ab53ae2a1592e3770">t_uint</a> sendingLayerIdx);
<a name="l00322"></a>00322 
<a name="l00330"></a>00330    <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classCommunicationLayer.html#deb8715ec00969db08c80cb20c065d02">insertLayer</a>(<a class="code" href="classCommunicationLayer.html#5076652ba2dc2a5f8c0b912baa2e9127">Directions</a> direction, 
<a name="l00331"></a>00331       <a class="code" href="classCommunicationLayer.html#81a0d144a97da5cd90fd3b2ec54fcdc6">CommunicationLayerPtr</a> layerToInsert);
<a name="l00332"></a>00332 
<a name="l00333"></a>00333 <span class="keyword">private</span>: 
<a name="l00334"></a>00334 
<a name="l00336"></a>00336    <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="utility_8hpp.html#b393a696e0318c8ab53ae2a1592e3770">t_uint</a> m_DEFAULT_MAX_QUEUE_LENGTH;
<a name="l00337"></a>00337 
<a name="l00341"></a>00341    NodePtr m_node;
<a name="l00342"></a>00342 
<a name="l00346"></a>00346    <a class="code" href="classSimTime.html">SimTime</a> m_lowerLayerDelay;
<a name="l00347"></a>00347 
<a name="l00351"></a>00351    <a class="code" href="classSimTime.html">SimTime</a> m_upperLayerDelay;
<a name="l00352"></a>00352 
<a name="l00356"></a>00356    vector&lt;CommunicationLayerPtr&gt; m_lowerLayers;
<a name="l00357"></a>00357 
<a name="l00361"></a>00361    vector&lt;CommunicationLayerPtr&gt; m_upperLayers;
<a name="l00362"></a>00362 
<a name="l00368"></a>00368    <a class="code" href="utility_8hpp.html#b393a696e0318c8ab53ae2a1592e3770">t_uint</a> m_defaultLowerLayerIdx;
<a name="l00369"></a>00369 
<a name="l00375"></a>00375    <a class="code" href="utility_8hpp.html#b393a696e0318c8ab53ae2a1592e3770">t_uint</a> m_defaultUpperLayerIdx;
<a name="l00376"></a>00376 
<a name="l00378"></a>00378    <a class="code" href="utility_8hpp.html#b393a696e0318c8ab53ae2a1592e3770">t_uint</a> m_maxQueueLength;
<a name="l00379"></a>00379 
<a name="l00383"></a>00383    list&lt;pair&lt;PacketPtr,t_uint&gt; &gt; m_packetQueue;
<a name="l00384"></a>00384 
<a name="l00389"></a>00389    <span class="keywordtype">bool</span> m_queueIsBlocked;
<a name="l00390"></a>00390 
<a name="l00391"></a>00391 };
<a name="l00392"></a>00392 <span class="keyword">typedef</span> boost::shared_ptr&lt;CommunicationLayer&gt; CommunicationLayerPtr;
<a name="l00393"></a>00393 
<a name="l00395"></a>00395 <span class="comment">// Inline Functions</span>
<a name="l00397"></a>00397 <span class="comment"></span>
<a name="l00398"></a><a class="code" href="classCommunicationLayer.html#39c60778d7fb9f62cda84eae80bf0395">00398</a> <span class="keyword">inline</span> NodePtr <a class="code" href="classCommunicationLayer.html#39c60778d7fb9f62cda84eae80bf0395">CommunicationLayer::getNode</a>()<span class="keyword"> const</span>
<a name="l00399"></a>00399 <span class="keyword"></span>{
<a name="l00400"></a>00400    <span class="keywordflow">return</span> m_node;
<a name="l00401"></a>00401 }
<a name="l00402"></a>00402 
<a name="l00403"></a><a class="code" href="classCommunicationLayer.html#e8d7522ba2ec2991d7302fe60b0ecbf0">00403</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classCommunicationLayer.html#e8d7522ba2ec2991d7302fe60b0ecbf0">CommunicationLayer::insertLowerLayer</a>(
<a name="l00404"></a>00404    CommunicationLayerPtr layerToInsert)
<a name="l00405"></a>00405 {
<a name="l00406"></a>00406    assert(layerToInsert.get() != 0);
<a name="l00407"></a>00407    assert(<a class="code" href="classCommunicationLayer.html#39c60778d7fb9f62cda84eae80bf0395">getNode</a>() == layerToInsert-&gt;getNode());
<a name="l00408"></a>00408    <a class="code" href="classCommunicationLayer.html#deb8715ec00969db08c80cb20c065d02">insertLayer</a>(<a class="code" href="classCommunicationLayer.html#5076652ba2dc2a5f8c0b912baa2e9127e110d3be994645ed51372e4be52ff311">CommunicationLayer::Directions_Lower</a>, layerToInsert);
<a name="l00409"></a>00409    layerToInsert-&gt;insertLayer(<a class="code" href="classCommunicationLayer.html#5076652ba2dc2a5f8c0b912baa2e91272ee130c439543c6b244d33b8745c6741">CommunicationLayer::Directions_Upper</a>, 
<a name="l00410"></a>00410       shared_from_this());
<a name="l00411"></a>00411 }
<a name="l00412"></a>00412 
<a name="l00413"></a><a class="code" href="classCommunicationLayer.html#deb8715ec00969db08c80cb20c065d02">00413</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classCommunicationLayer.html#deb8715ec00969db08c80cb20c065d02">CommunicationLayer::insertLayer</a>(
<a name="l00414"></a>00414    <a class="code" href="classCommunicationLayer.html#5076652ba2dc2a5f8c0b912baa2e9127">CommunicationLayer::Directions</a> direction,
<a name="l00415"></a>00415    CommunicationLayerPtr layerToInsert)
<a name="l00416"></a>00416 {
<a name="l00417"></a>00417    assert(layerToInsert.get() != 0);
<a name="l00418"></a>00418    assert(<a class="code" href="classCommunicationLayer.html#39c60778d7fb9f62cda84eae80bf0395">getNode</a>() == layerToInsert-&gt;getNode());
<a name="l00419"></a>00419    <span class="keywordflow">switch</span>(direction) {
<a name="l00420"></a>00420    <span class="keywordflow">case</span> <a class="code" href="classCommunicationLayer.html#5076652ba2dc2a5f8c0b912baa2e9127e110d3be994645ed51372e4be52ff311">CommunicationLayer::Directions_Lower</a>:
<a name="l00421"></a>00421       m_lowerLayers.push_back(layerToInsert);
<a name="l00422"></a>00422       <span class="keywordflow">break</span>;
<a name="l00423"></a>00423    <span class="keywordflow">case</span> <a class="code" href="classCommunicationLayer.html#5076652ba2dc2a5f8c0b912baa2e91272ee130c439543c6b244d33b8745c6741">CommunicationLayer::Directions_Upper</a>:
<a name="l00424"></a>00424       m_upperLayers.push_back(layerToInsert);
<a name="l00425"></a>00425       <span class="keywordflow">break</span>;
<a name="l00426"></a>00426    <span class="keywordflow">default</span>:
<a name="l00427"></a>00427       assert(<span class="keyword">false</span>);
<a name="l00428"></a>00428    }
<a name="l00429"></a>00429    <span class="comment">// If this is the first layer inserted, set it as the</span>
<a name="l00430"></a>00430    <span class="comment">// default layer</span>
<a name="l00431"></a>00431    <span class="keywordflow">if</span>(<a class="code" href="classCommunicationLayer.html#f99fc2c30b2e3f08d02d7c60a6b85927">numberOfLayers</a>(direction) == 1)
<a name="l00432"></a>00432       <a class="code" href="classCommunicationLayer.html#1c49b67142c7ce48284d2cceed4353fb">setDefaultLayer</a>(direction, 0);
<a name="l00433"></a>00433 }
<a name="l00434"></a>00434 
<a name="l00435"></a><a class="code" href="classCommunicationLayer.html#8e5223a8bba2940517f4e616b5ceb7db">00435</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classCommunicationLayer.html#8e5223a8bba2940517f4e616b5ceb7db">CommunicationLayer::blockQueue</a>()
<a name="l00436"></a>00436 {
<a name="l00437"></a>00437    m_queueIsBlocked = <span class="keyword">true</span>;
<a name="l00438"></a>00438 }
<a name="l00439"></a>00439 
<a name="l00440"></a><a class="code" href="classCommunicationLayer.html#3cdc193a177fa4728f8b7a0eb73121fa">00440</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classCommunicationLayer.html#3cdc193a177fa4728f8b7a0eb73121fa">CommunicationLayer::unblockQueue</a>()
<a name="l00441"></a>00441 {
<a name="l00442"></a>00442    m_queueIsBlocked = <span class="keyword">false</span>;
<a name="l00443"></a>00443    <a class="code" href="classCommunicationLayer.html#86c3c9f905fa39c1193e1f51a1d24a99">sendFromQueue</a>();
<a name="l00444"></a>00444 }
<a name="l00445"></a>00445 
<a name="l00446"></a><a class="code" href="classCommunicationLayer.html#b1a9429e4031d925ed2f1eea070147ef">00446</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classCommunicationLayer.html#b1a9429e4031d925ed2f1eea070147ef">CommunicationLayer::setLowerLayerRecvEventPending</a>(
<a name="l00447"></a>00447    <span class="keywordtype">bool</span> isPending)
<a name="l00448"></a>00448 {
<a name="l00449"></a>00449    <span class="keywordtype">bool</span> previousValue = <a class="code" href="classCommunicationLayer.html#ab2bcbf24c42ad6054d5920ebf108026">m_lowerLayerRecvEventPending</a>;
<a name="l00450"></a>00450    <a class="code" href="classCommunicationLayer.html#ab2bcbf24c42ad6054d5920ebf108026">m_lowerLayerRecvEventPending</a> = isPending;
<a name="l00451"></a>00451    <span class="comment">// If there was an event pending, but there no longer is,</span>
<a name="l00452"></a>00452    <span class="comment">// then we need to try sending from the queue again.</span>
<a name="l00453"></a>00453    <span class="keywordflow">if</span>(previousValue &amp;&amp; !<a class="code" href="classCommunicationLayer.html#ab2bcbf24c42ad6054d5920ebf108026">m_lowerLayerRecvEventPending</a>)
<a name="l00454"></a>00454       <a class="code" href="classCommunicationLayer.html#86c3c9f905fa39c1193e1f51a1d24a99">sendFromQueue</a>();
<a name="l00455"></a>00455 }
<a name="l00456"></a>00456 
<a name="l00457"></a><a class="code" href="classCommunicationLayer.html#dbb99928c467117bd35b1c4b71330ade">00457</a> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classCommunicationLayer.html#dbb99928c467117bd35b1c4b71330ade">CommunicationLayer::getQueueIsBlocked</a>()<span class="keyword"> const</span>
<a name="l00458"></a>00458 <span class="keyword"></span>{
<a name="l00459"></a>00459    <span class="keywordflow">return</span> m_queueIsBlocked;
<a name="l00460"></a>00460 }
<a name="l00461"></a>00461 
<a name="l00462"></a><a class="code" href="classCommunicationLayer.html#92b821de3192e463f7850bc6626e6f86">00462</a> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classCommunicationLayer.html#92b821de3192e463f7850bc6626e6f86">CommunicationLayer::queueIsFull</a>()<span class="keyword"> const</span>
<a name="l00463"></a>00463 <span class="keyword"></span>{
<a name="l00464"></a>00464    assert(m_packetQueue.size() &lt;= m_maxQueueLength);
<a name="l00465"></a>00465    <span class="keywordflow">return</span> (m_packetQueue.size() == m_maxQueueLength);
<a name="l00466"></a>00466 }
<a name="l00467"></a>00467 
<a name="l00468"></a><a class="code" href="classCommunicationLayer.html#857d6b46cce18e15099a4eaa7246176a">00468</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classCommunicationLayer.html#857d6b46cce18e15099a4eaa7246176a">CommunicationLayer::setMaxQueueLength</a>(<a class="code" href="utility_8hpp.html#b393a696e0318c8ab53ae2a1592e3770">t_uint</a> maxQueueLength)
<a name="l00469"></a>00469 {
<a name="l00470"></a>00470    assert(maxQueueLength &gt; 0);
<a name="l00471"></a>00471    m_maxQueueLength = maxQueueLength;
<a name="l00472"></a>00472 }
<a name="l00473"></a>00473 
<a name="l00474"></a><a class="code" href="classCommunicationLayer.html#1263c7097c8587a490cb90518d4d7585">00474</a> <span class="keyword">inline</span> <a class="code" href="utility_8hpp.html#b393a696e0318c8ab53ae2a1592e3770">t_uint</a> <a class="code" href="classCommunicationLayer.html#1263c7097c8587a490cb90518d4d7585">CommunicationLayer::getMaxQueueLength</a>()<span class="keyword"> const</span>
<a name="l00475"></a>00475 <span class="keyword"></span>{
<a name="l00476"></a>00476    <span class="keywordflow">return</span> m_maxQueueLength;
<a name="l00477"></a>00477 }
<a name="l00478"></a>00478 
<a name="l00479"></a><a class="code" href="classCommunicationLayer.html#7518faba7445c8c61d283575d2962283">00479</a> <span class="keyword">inline</span> CommunicationLayerPtr <a class="code" href="classCommunicationLayer.html#7518faba7445c8c61d283575d2962283">CommunicationLayer::getLayer</a>(
<a name="l00480"></a>00480    <a class="code" href="classCommunicationLayer.html#5076652ba2dc2a5f8c0b912baa2e9127">CommunicationLayer::Directions</a> direction, <a class="code" href="utility_8hpp.html#b393a696e0318c8ab53ae2a1592e3770">t_uint</a> sendingLayerIdx)
<a name="l00481"></a>00481 {
<a name="l00482"></a>00482    assert(sendingLayerIdx &lt; <a class="code" href="classCommunicationLayer.html#f99fc2c30b2e3f08d02d7c60a6b85927">numberOfLayers</a>(direction));
<a name="l00483"></a>00483 
<a name="l00484"></a>00484    vector&lt;CommunicationLayerPtr&gt;* layerVector = 0;
<a name="l00485"></a>00485    <span class="keywordflow">switch</span>(direction) {
<a name="l00486"></a>00486    <span class="keywordflow">case</span> <a class="code" href="classCommunicationLayer.html#5076652ba2dc2a5f8c0b912baa2e9127e110d3be994645ed51372e4be52ff311">Directions_Lower</a>:
<a name="l00487"></a>00487       layerVector = &amp;m_lowerLayers;
<a name="l00488"></a>00488       <span class="keywordflow">break</span>;
<a name="l00489"></a>00489    <span class="keywordflow">case</span> <a class="code" href="classCommunicationLayer.html#5076652ba2dc2a5f8c0b912baa2e91272ee130c439543c6b244d33b8745c6741">Directions_Upper</a>:
<a name="l00490"></a>00490       layerVector = &amp;m_upperLayers;
<a name="l00491"></a>00491       <span class="keywordflow">break</span>;
<a name="l00492"></a>00492    <span class="keywordflow">default</span>:
<a name="l00493"></a>00493       assert(<span class="keyword">false</span>);
<a name="l00494"></a>00494    }
<a name="l00495"></a>00495    assert(layerVector != 0);
<a name="l00496"></a>00496 
<a name="l00497"></a>00497    <span class="keywordflow">return</span> (*layerVector)[sendingLayerIdx];
<a name="l00498"></a>00498 
<a name="l00499"></a>00499 }
<a name="l00500"></a>00500 
<a name="l00501"></a><a class="code" href="classCommunicationLayer.html#f99fc2c30b2e3f08d02d7c60a6b85927">00501</a> <span class="keyword">inline</span> <a class="code" href="utility_8hpp.html#b393a696e0318c8ab53ae2a1592e3770">t_uint</a> <a class="code" href="classCommunicationLayer.html#f99fc2c30b2e3f08d02d7c60a6b85927">CommunicationLayer::numberOfLayers</a>(
<a name="l00502"></a>00502    <a class="code" href="classCommunicationLayer.html#5076652ba2dc2a5f8c0b912baa2e9127">CommunicationLayer::Directions</a> direction)<span class="keyword"> const</span>
<a name="l00503"></a>00503 <span class="keyword"></span>{
<a name="l00504"></a>00504    <span class="keywordflow">switch</span>(direction) {
<a name="l00505"></a>00505    <span class="keywordflow">case</span> <a class="code" href="classCommunicationLayer.html#5076652ba2dc2a5f8c0b912baa2e9127e110d3be994645ed51372e4be52ff311">CommunicationLayer::Directions_Lower</a>:
<a name="l00506"></a>00506       <span class="keywordflow">return</span> m_lowerLayers.size();
<a name="l00507"></a>00507       <span class="keywordflow">break</span>;
<a name="l00508"></a>00508    <span class="keywordflow">case</span> <a class="code" href="classCommunicationLayer.html#5076652ba2dc2a5f8c0b912baa2e91272ee130c439543c6b244d33b8745c6741">CommunicationLayer::Directions_Upper</a>:
<a name="l00509"></a>00509       <span class="keywordflow">return</span> m_upperLayers.size();
<a name="l00510"></a>00510       <span class="keywordflow">break</span>;
<a name="l00511"></a>00511    <span class="keywordflow">default</span>:
<a name="l00512"></a>00512       assert(<span class="keyword">false</span>);
<a name="l00513"></a>00513       <span class="keywordflow">return</span> 0;
<a name="l00514"></a>00514    }
<a name="l00515"></a>00515 }
<a name="l00516"></a>00516 
<a name="l00517"></a><a class="code" href="classCommunicationLayer.html#1c49b67142c7ce48284d2cceed4353fb">00517</a> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classCommunicationLayer.html#1c49b67142c7ce48284d2cceed4353fb">CommunicationLayer::setDefaultLayer</a>(
<a name="l00518"></a>00518    <a class="code" href="classCommunicationLayer.html#5076652ba2dc2a5f8c0b912baa2e9127">CommunicationLayer::Directions</a> direction, <a class="code" href="utility_8hpp.html#b393a696e0318c8ab53ae2a1592e3770">t_uint</a> newDefaultIdx)
<a name="l00519"></a>00519 {
<a name="l00520"></a>00520    <span class="keywordtype">bool</span> <a class="code" href="classCommunicationLayer.html#1c49b67142c7ce48284d2cceed4353fb">setDefaultLayer</a> = <span class="keyword">false</span>;
<a name="l00521"></a>00521    <span class="keywordflow">if</span>(newDefaultIdx &lt; <a class="code" href="classCommunicationLayer.html#f99fc2c30b2e3f08d02d7c60a6b85927">numberOfLayers</a>(direction)) {
<a name="l00522"></a>00522       <span class="keywordflow">switch</span>(direction) {
<a name="l00523"></a>00523       <span class="keywordflow">case</span> <a class="code" href="classCommunicationLayer.html#5076652ba2dc2a5f8c0b912baa2e9127e110d3be994645ed51372e4be52ff311">CommunicationLayer::Directions_Lower</a>:
<a name="l00524"></a>00524          m_defaultLowerLayerIdx = newDefaultIdx;
<a name="l00525"></a>00525          <span class="keywordflow">break</span>;
<a name="l00526"></a>00526       <span class="keywordflow">case</span> <a class="code" href="classCommunicationLayer.html#5076652ba2dc2a5f8c0b912baa2e91272ee130c439543c6b244d33b8745c6741">CommunicationLayer::Directions_Upper</a>:
<a name="l00527"></a>00527          m_defaultUpperLayerIdx = newDefaultIdx;
<a name="l00528"></a>00528          <span class="keywordflow">break</span>;
<a name="l00529"></a>00529       <span class="keywordflow">default</span>:
<a name="l00530"></a>00530          assert(<span class="keyword">false</span>);
<a name="l00531"></a>00531       }
<a name="l00532"></a>00532       setDefaultLayer = <span class="keyword">true</span>;
<a name="l00533"></a>00533    }
<a name="l00534"></a>00534 
<a name="l00535"></a>00535    <span class="keywordflow">return</span> setDefaultLayer;
<a name="l00536"></a>00536 }
<a name="l00537"></a>00537 
<a name="l00538"></a><a class="code" href="classCommunicationLayer.html#a8660c7360286ab21093f1f0e75b09d9">00538</a> <span class="keyword">inline</span> <a class="code" href="utility_8hpp.html#b393a696e0318c8ab53ae2a1592e3770">t_uint</a> <a class="code" href="classCommunicationLayer.html#a8660c7360286ab21093f1f0e75b09d9">CommunicationLayer::getDefaultLayer</a>(
<a name="l00539"></a>00539    <a class="code" href="classCommunicationLayer.html#5076652ba2dc2a5f8c0b912baa2e9127">CommunicationLayer::Directions</a> direction)<span class="keyword"> const</span>
<a name="l00540"></a>00540 <span class="keyword"></span>{
<a name="l00541"></a>00541    <span class="keywordflow">switch</span>(direction) {
<a name="l00542"></a>00542    <span class="keywordflow">case</span> <a class="code" href="classCommunicationLayer.html#5076652ba2dc2a5f8c0b912baa2e9127e110d3be994645ed51372e4be52ff311">CommunicationLayer::Directions_Lower</a>:
<a name="l00543"></a>00543       <span class="keywordflow">return</span> m_defaultLowerLayerIdx;
<a name="l00544"></a>00544       <span class="keywordflow">break</span>;
<a name="l00545"></a>00545    <span class="keywordflow">case</span> <a class="code" href="classCommunicationLayer.html#5076652ba2dc2a5f8c0b912baa2e91272ee130c439543c6b244d33b8745c6741">CommunicationLayer::Directions_Upper</a>:
<a name="l00546"></a>00546       <span class="keywordflow">return</span> m_defaultUpperLayerIdx;
<a name="l00547"></a>00547       <span class="keywordflow">break</span>;
<a name="l00548"></a>00548    <span class="keywordflow">default</span>:
<a name="l00549"></a>00549       assert(<span class="keyword">false</span>);
<a name="l00550"></a>00550       <span class="keywordflow">return</span> 0;
<a name="l00551"></a>00551    }
<a name="l00552"></a>00552 }
<a name="l00553"></a>00553 
<a name="l00554"></a><a class="code" href="classCommunicationLayer.html#062a1403bdaf80498283039a872b20b1">00554</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classCommunicationLayer.html#062a1403bdaf80498283039a872b20b1">CommunicationLayer::setLayerDelay</a>(
<a name="l00555"></a>00555    <a class="code" href="classCommunicationLayer.html#5076652ba2dc2a5f8c0b912baa2e9127">CommunicationLayer::Directions</a> direction, <span class="keyword">const</span> <a class="code" href="classSimTime.html">SimTime</a>&amp; delay)
<a name="l00556"></a>00556 {
<a name="l00557"></a>00557    <span class="keywordflow">switch</span>(direction) {
<a name="l00558"></a>00558    <span class="keywordflow">case</span> <a class="code" href="classCommunicationLayer.html#5076652ba2dc2a5f8c0b912baa2e9127e110d3be994645ed51372e4be52ff311">CommunicationLayer::Directions_Lower</a>:
<a name="l00559"></a>00559       m_lowerLayerDelay = delay;
<a name="l00560"></a>00560       <span class="keywordflow">break</span>;
<a name="l00561"></a>00561    <span class="keywordflow">case</span> <a class="code" href="classCommunicationLayer.html#5076652ba2dc2a5f8c0b912baa2e91272ee130c439543c6b244d33b8745c6741">CommunicationLayer::Directions_Upper</a>:
<a name="l00562"></a>00562       m_upperLayerDelay = delay;
<a name="l00563"></a>00563       <span class="keywordflow">break</span>;
<a name="l00564"></a>00564    <span class="keywordflow">default</span>:
<a name="l00565"></a>00565       assert(<span class="keyword">false</span>);
<a name="l00566"></a>00566    }
<a name="l00567"></a>00567 }
<a name="l00568"></a>00568 
<a name="l00569"></a><a class="code" href="classCommunicationLayer.html#d068c81501292c66601e900dbe2ca120">00569</a> <span class="keyword">inline</span> <a class="code" href="classSimTime.html">SimTime</a> <a class="code" href="classCommunicationLayer.html#d068c81501292c66601e900dbe2ca120">CommunicationLayer::getLayerDelay</a>(
<a name="l00570"></a>00570    <a class="code" href="classCommunicationLayer.html#5076652ba2dc2a5f8c0b912baa2e9127">CommunicationLayer::Directions</a> direction)<span class="keyword"> const</span>
<a name="l00571"></a>00571 <span class="keyword"></span>{
<a name="l00572"></a>00572    <span class="keywordflow">switch</span>(direction) {
<a name="l00573"></a>00573    <span class="keywordflow">case</span> <a class="code" href="classCommunicationLayer.html#5076652ba2dc2a5f8c0b912baa2e9127e110d3be994645ed51372e4be52ff311">CommunicationLayer::Directions_Lower</a>:
<a name="l00574"></a>00574       <span class="keywordflow">return</span> m_lowerLayerDelay;
<a name="l00575"></a>00575       <span class="keywordflow">break</span>;
<a name="l00576"></a>00576    <span class="keywordflow">case</span> <a class="code" href="classCommunicationLayer.html#5076652ba2dc2a5f8c0b912baa2e91272ee130c439543c6b244d33b8745c6741">CommunicationLayer::Directions_Upper</a>:
<a name="l00577"></a>00577       <span class="keywordflow">return</span> m_upperLayerDelay;
<a name="l00578"></a>00578       <span class="keywordflow">break</span>;
<a name="l00579"></a>00579    <span class="keywordflow">default</span>:
<a name="l00580"></a>00580       assert(<span class="keyword">false</span>);
<a name="l00581"></a>00581       <a class="code" href="classSimTime.html">SimTime</a> neverReturned;
<a name="l00582"></a>00582       <span class="keywordflow">return</span> neverReturned;
<a name="l00583"></a>00583    }
<a name="l00584"></a>00584 }
<a name="l00585"></a>00585 
<a name="l00587"></a>00587 <span class="comment">// Overloaded Operators</span>
<a name="l00589"></a>00589 <span class="comment"></span>
<a name="l00590"></a>00590 <span class="keyword">inline</span> ostream&amp; operator&lt;&lt; (ostream&amp; s, 
<a name="l00591"></a>00591       <span class="keyword">const</span> <a class="code" href="classCommunicationLayer.html">CommunicationLayer</a>&amp; communicationLayer)
<a name="l00592"></a>00592 {
<a name="l00593"></a>00593    <span class="keywordflow">return</span> s&lt;&lt; <span class="stringliteral">"CommunicationLayer state (pointer="</span> &lt;&lt; 
<a name="l00594"></a>00594          &amp;communicationLayer &lt;&lt; <span class="stringliteral">", number of upper layers= "</span> &lt;&lt; 
<a name="l00595"></a>00595          communicationLayer.<a class="code" href="classCommunicationLayer.html#f99fc2c30b2e3f08d02d7c60a6b85927">numberOfLayers</a>(
<a name="l00596"></a>00596          <a class="code" href="classCommunicationLayer.html#5076652ba2dc2a5f8c0b912baa2e91272ee130c439543c6b244d33b8745c6741">CommunicationLayer::Directions_Upper</a>) &lt;&lt; 
<a name="l00597"></a>00597          <span class="stringliteral">", number of lower layers= "</span> &lt;&lt;
<a name="l00598"></a>00598          communicationLayer.<a class="code" href="classCommunicationLayer.html#f99fc2c30b2e3f08d02d7c60a6b85927">numberOfLayers</a>(
<a name="l00599"></a>00599          <a class="code" href="classCommunicationLayer.html#5076652ba2dc2a5f8c0b912baa2e9127e110d3be994645ed51372e4be52ff311">CommunicationLayer::Directions_Lower</a>) &lt;&lt; 
<a name="l00600"></a>00600          <span class="stringliteral">", default upper layer= "</span> &lt;&lt;
<a name="l00601"></a>00601          communicationLayer.<a class="code" href="classCommunicationLayer.html#a8660c7360286ab21093f1f0e75b09d9">getDefaultLayer</a>(
<a name="l00602"></a>00602          <a class="code" href="classCommunicationLayer.html#5076652ba2dc2a5f8c0b912baa2e91272ee130c439543c6b244d33b8745c6741">CommunicationLayer::Directions_Upper</a>) &lt;&lt; 
<a name="l00603"></a>00603          <span class="stringliteral">", default lower layer= "</span> &lt;&lt;
<a name="l00604"></a>00604          communicationLayer.<a class="code" href="classCommunicationLayer.html#a8660c7360286ab21093f1f0e75b09d9">getDefaultLayer</a>(
<a name="l00605"></a>00605          CommunicationLayer::Directions_Lower) &lt;&lt; 
<a name="l00606"></a>00606          <span class="stringliteral">", upper layer delay= "</span> &lt;&lt;
<a name="l00607"></a>00607          communicationLayer.<a class="code" href="classCommunicationLayer.html#d068c81501292c66601e900dbe2ca120">getLayerDelay</a>(
<a name="l00608"></a>00608          CommunicationLayer::Directions_Upper) &lt;&lt; 
<a name="l00609"></a>00609          <span class="stringliteral">", lower layer delay= "</span> &lt;&lt;
<a name="l00610"></a>00610          communicationLayer.<a class="code" href="classCommunicationLayer.html#d068c81501292c66601e900dbe2ca120">getLayerDelay</a>(
<a name="l00611"></a>00611          CommunicationLayer::Directions_Lower) &lt;&lt; 
<a name="l00612"></a>00612          <span class="stringliteral">")"</span>;
<a name="l00613"></a>00613 }
<a name="l00614"></a>00614 
<a name="l00615"></a>00615 <span class="keyword">inline</span> ostream&amp; operator&lt;&lt; (ostream&amp; s, 
<a name="l00616"></a>00616       <span class="keyword">const</span> <a class="code" href="classCommunicationLayer.html#4cbb01eeaddc7b36151fe34379aa56e6">CommunicationLayer::Types</a>&amp; communicationLayerType)
<a name="l00617"></a>00617 {
<a name="l00618"></a>00618 
<a name="l00619"></a>00619    <span class="keywordflow">switch</span> (communicationLayerType) {
<a name="l00620"></a>00620       <span class="keywordflow">case</span> <a class="code" href="classCommunicationLayer.html#4cbb01eeaddc7b36151fe34379aa56e642f157e36bc169d12ccc314cbbca49a9">CommunicationLayer::Types_Physical</a>:
<a name="l00621"></a>00621          s &lt;&lt; <span class="stringliteral">"PHY"</span>;
<a name="l00622"></a>00622          <span class="keywordflow">break</span>;
<a name="l00623"></a>00623       <span class="keywordflow">case</span> <a class="code" href="classCommunicationLayer.html#4cbb01eeaddc7b36151fe34379aa56e6f18b7936d0f2478bd354224444cb993f">CommunicationLayer::Types_Link</a>:
<a name="l00624"></a>00624          s &lt;&lt; <span class="stringliteral">"LINK"</span>;
<a name="l00625"></a>00625          <span class="keywordflow">break</span>;
<a name="l00626"></a>00626       <span class="keywordflow">case</span> <a class="code" href="classCommunicationLayer.html#4cbb01eeaddc7b36151fe34379aa56e620a9f99157d61bce3a7d5782ca467150">CommunicationLayer::Types_Network</a>:
<a name="l00627"></a>00627          s &lt;&lt; <span class="stringliteral">"NET"</span>;
<a name="l00628"></a>00628          <span class="keywordflow">break</span>;
<a name="l00629"></a>00629       <span class="keywordflow">case</span> <a class="code" href="classCommunicationLayer.html#4cbb01eeaddc7b36151fe34379aa56e6ef54f2c3aeee1b552ef0d77b1cf964d4">CommunicationLayer::Types_Transport</a>:
<a name="l00630"></a>00630          s &lt;&lt; <span class="stringliteral">"TRAN"</span>;
<a name="l00631"></a>00631          <span class="keywordflow">break</span>;
<a name="l00632"></a>00632       <span class="keywordflow">case</span> <a class="code" href="classCommunicationLayer.html#4cbb01eeaddc7b36151fe34379aa56e6283a1bc99f61ba8edc4f587c36becf7f">CommunicationLayer::Types_Application</a>:
<a name="l00633"></a>00633          s &lt;&lt; <span class="stringliteral">"APP"</span>;
<a name="l00634"></a>00634          <span class="keywordflow">break</span>;
<a name="l00635"></a>00635    }
<a name="l00636"></a>00636 
<a name="l00637"></a>00637    <span class="keywordflow">return</span> s;
<a name="l00638"></a>00638 
<a name="l00639"></a>00639 }
<a name="l00640"></a>00640 
<a name="l00642"></a>00642 <span class="comment">// Event Subclasses</span>
<a name="l00644"></a>00644 <span class="comment"></span>
<a name="l00649"></a><a class="code" href="classLayerRecvEvent.html">00649</a> <span class="keyword">class </span><a class="code" href="classLayerRecvEvent.html">LayerRecvEvent</a> : <span class="keyword">public</span> <a class="code" href="classEvent.html">Event</a> {
<a name="l00650"></a>00650 <span class="keyword">public</span>:
<a name="l00652"></a><a class="code" href="classLayerRecvEvent.html#1260b2ab8b905d1f002e9df71975ae17">00652</a>    <span class="keyword">typedef</span> boost::shared_ptr&lt;LayerRecvEvent&gt; <a class="code" href="classLayerRecvEvent.html#1260b2ab8b905d1f002e9df71975ae17">LayerRecvEventPtr</a>;
<a name="l00653"></a>00653 
<a name="l00658"></a><a class="code" href="classLayerRecvEvent.html#037d1385362c178b27c8923aca959e4e">00658</a>    <span class="keyword">static</span> <span class="keyword">inline</span> <a class="code" href="classLayerRecvEvent.html#1260b2ab8b905d1f002e9df71975ae17">LayerRecvEventPtr</a> <a class="code" href="classLayerRecvEvent.html#037d1385362c178b27c8923aca959e4e">create</a>(
<a name="l00659"></a>00659       <a class="code" href="classCommunicationLayer.html#5076652ba2dc2a5f8c0b912baa2e9127">CommunicationLayer::Directions</a> sendDirection,
<a name="l00660"></a>00660       PacketPtr packet, 
<a name="l00661"></a>00661       CommunicationLayerPtr recvingLayer, 
<a name="l00662"></a>00662       CommunicationLayerPtr sendingLayer)
<a name="l00663"></a>00663    {
<a name="l00664"></a>00664       <a class="code" href="classLayerRecvEvent.html#1260b2ab8b905d1f002e9df71975ae17">LayerRecvEventPtr</a> p(<span class="keyword">new</span> <a class="code" href="classLayerRecvEvent.html#1af5f36f92b8bf5bb498535ca82c5a6e">LayerRecvEvent</a>(sendDirection,
<a name="l00665"></a>00665          packet, recvingLayer, sendingLayer));
<a name="l00666"></a>00666       <span class="keywordflow">return</span> p;
<a name="l00667"></a>00667    }
<a name="l00668"></a>00668 
<a name="l00669"></a><a class="code" href="classLayerRecvEvent.html#079b7b23f668b15675c688b6d9bcbc12">00669</a>    <span class="keywordtype">void</span> <a class="code" href="classLayerRecvEvent.html#079b7b23f668b15675c688b6d9bcbc12">execute</a>()
<a name="l00670"></a>00670    {
<a name="l00671"></a>00671       <span class="comment">// Give a default recvDirection for the compiler even</span>
<a name="l00672"></a>00672       <span class="comment">// though the switch statement should be setup such</span>
<a name="l00673"></a>00673       <span class="comment">// that it is guaranteed to set recvDirection.</span>
<a name="l00674"></a>00674       <a class="code" href="classCommunicationLayer.html#5076652ba2dc2a5f8c0b912baa2e9127">CommunicationLayer::Directions</a> recvDirection = 
<a name="l00675"></a>00675          CommunicationLayer::Directions_Upper;
<a name="l00676"></a>00676 
<a name="l00677"></a>00677       <span class="comment">// Just toggle the direction from the sending direction.</span>
<a name="l00678"></a>00678       <span class="keywordflow">switch</span>(m_sendDirection) {
<a name="l00679"></a>00679       <span class="keywordflow">case</span> CommunicationLayer::Directions_Lower:
<a name="l00680"></a>00680          recvDirection = CommunicationLayer::Directions_Upper;
<a name="l00681"></a>00681          <span class="keywordflow">break</span>;
<a name="l00682"></a>00682       <span class="keywordflow">case</span> CommunicationLayer::Directions_Upper:
<a name="l00683"></a>00683          recvDirection = CommunicationLayer::Directions_Lower;
<a name="l00684"></a>00684          <span class="keywordflow">break</span>;
<a name="l00685"></a>00685       <span class="keywordflow">default</span>:
<a name="l00686"></a>00686          assert(<span class="keyword">false</span>);
<a name="l00687"></a>00687       }
<a name="l00688"></a>00688 
<a name="l00689"></a>00689       assert(m_recvingLayer.get() != 0);
<a name="l00690"></a>00690       m_recvingLayer-&gt;recvFromLayer(recvDirection, m_packet, 
<a name="l00691"></a>00691          m_sendingLayer);
<a name="l00692"></a>00692       <span class="keywordflow">if</span>(m_sendDirection == CommunicationLayer::Directions_Lower) {
<a name="l00693"></a>00693          assert(m_sendingLayer.get() != 0);
<a name="l00694"></a>00694          m_sendingLayer-&gt;setLowerLayerRecvEventPending(<span class="keyword">false</span>);
<a name="l00695"></a>00695       }
<a name="l00696"></a>00696    }
<a name="l00697"></a>00697 
<a name="l00698"></a>00698 <span class="keyword">protected</span>:
<a name="l00700"></a><a class="code" href="classLayerRecvEvent.html#1af5f36f92b8bf5bb498535ca82c5a6e">00700</a>    <a class="code" href="classLayerRecvEvent.html#1af5f36f92b8bf5bb498535ca82c5a6e">LayerRecvEvent</a>(<a class="code" href="classCommunicationLayer.html#5076652ba2dc2a5f8c0b912baa2e9127">CommunicationLayer::Directions</a> sendDirection,
<a name="l00701"></a>00701       PacketPtr packet, 
<a name="l00702"></a>00702       CommunicationLayerPtr recvingLayer, 
<a name="l00703"></a>00703       CommunicationLayerPtr sendingLayer)
<a name="l00704"></a>00704          : <a class="code" href="classEvent.html">Event</a>()
<a name="l00705"></a>00705    {
<a name="l00706"></a>00706       m_sendDirection = sendDirection;
<a name="l00707"></a>00707       m_packet = packet;
<a name="l00708"></a>00708       m_recvingLayer = recvingLayer;
<a name="l00709"></a>00709       m_sendingLayer = sendingLayer;
<a name="l00710"></a>00710    }
<a name="l00711"></a>00711 
<a name="l00712"></a>00712 <span class="keyword">private</span>:
<a name="l00713"></a>00713    PacketPtr m_packet;
<a name="l00714"></a>00714    <a class="code" href="classCommunicationLayer.html#5076652ba2dc2a5f8c0b912baa2e9127">CommunicationLayer::Directions</a> m_sendDirection;
<a name="l00715"></a>00715    CommunicationLayerPtr m_recvingLayer;
<a name="l00716"></a>00716    CommunicationLayerPtr m_sendingLayer;
<a name="l00717"></a>00717 };
<a name="l00718"></a>00718 <span class="keyword">typedef</span> boost::shared_ptr&lt;LayerRecvEvent&gt; LayerRecvEventPtr;
<a name="l00719"></a>00719 
<a name="l00720"></a>00720 <span class="preprocessor">#endif // COMMUNICATION_LAYER_H</span>
<a name="l00721"></a>00721 <span class="preprocessor"></span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Dec 12 17:04:37 2006 for rfidsim by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
