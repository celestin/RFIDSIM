<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>rfidsim: physical_layer.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
  </ul></div>
<h1>physical_layer.cpp</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00002"></a>00002 <span class="preprocessor">#include "physical_layer.hpp"</span>
<a name="l00003"></a>00003 <span class="preprocessor">#include "node.hpp"</span>
<a name="l00004"></a>00004 <span class="preprocessor">#include "packet.hpp"</span>
<a name="l00005"></a>00005 
<a name="l00006"></a>00006 <span class="comment">// These values are from a variety of sources, most</span>
<a name="l00007"></a>00007 <span class="comment">// notably Alien and EPCglobal.</span>
<a name="l00008"></a>00008 
<a name="l00009"></a>00009 <span class="comment">// Alien ALR-9800: 30 dBm RF Power == 1 Watt</span>
<a name="l00010"></a>00010 <span class="keyword">const</span> <span class="keywordtype">double</span> PhysicalLayer::m_DEFAULT_TX_POWER = 1.0;
<a name="l00011"></a>00011 <span class="keyword">const</span> <span class="keywordtype">double</span> PhysicalLayer::m_DEFAULT_MAX_TX_POWER = 1.0;
<a name="l00012"></a>00012 <span class="comment">// This is based on published reports that the received</span>
<a name="l00013"></a>00013 <span class="comment">// power should be 100 to 400 microwatts for commercial tags.</span>
<a name="l00014"></a>00014 <span class="comment">// www.enigmatic-consulting.com/Communications_articles/</span>
<a name="l00015"></a>00015 <span class="comment">// RFID/Link_budgets.html</span>
<a name="l00016"></a>00016 <span class="keyword">const</span> <span class="keywordtype">double</span> PhysicalLayer::m_DEFAULT_RX_THRESHOLD = 100e-6;
<a name="l00017"></a>00017 <span class="comment">// In ns-2 the default ratio between CS and RX is about a</span>
<a name="l00018"></a>00018 <span class="comment">// factor of 23.</span>
<a name="l00019"></a>00019 <span class="keyword">const</span> <span class="keywordtype">double</span> PhysicalLayer::m_DEFAULT_CS_THRESHOLD = 5e-6;
<a name="l00020"></a>00020 <span class="comment">// This is from ns-2</span>
<a name="l00021"></a>00021 <span class="keyword">const</span> <span class="keywordtype">double</span> PhysicalLayer::m_DEFAULT_CAPTURE_THRESHOLD = 10;
<a name="l00022"></a>00022 <span class="comment">// This is -111 dBm, which is the thermal noise floor for</span>
<a name="l00023"></a>00023 <span class="comment">// GPS signals and the default for Qualnet</span>
<a name="l00024"></a>00024 <span class="keyword">const</span> <span class="keywordtype">double</span> PhysicalLayer::m_DEFAULT_MINIMUM_SIGNAL_STRENGTH = 7.94e-12;
<a name="l00025"></a>00025 <span class="comment">// EPCglobal: 26.7 to 128 kbps for reader</span>
<a name="l00026"></a>00026 <span class="comment">// 40 to 640 kbps or 5 to 320 kbps for tag depending on modulation</span>
<a name="l00027"></a>00027 <span class="keyword">const</span> <span class="keywordtype">double</span> PhysicalLayer::m_DEFAULT_DATA_RATE = 128e3;
<a name="l00028"></a>00028 <span class="comment">// EPCglobal: 860 to 960 MHz</span>
<a name="l00029"></a>00029 <span class="keyword">const</span> <span class="keywordtype">double</span> PhysicalLayer::m_DEFAULT_BANDWIDTH = 960e6;
<a name="l00030"></a>00030 
<a name="l00031"></a>00031 <span class="comment">// Temperature is in Kelvins</span>
<a name="l00032"></a>00032 <span class="keyword">const</span> <span class="keywordtype">double</span> PhysicalLayer::m_RADIO_TEMPERATURE = 290;
<a name="l00033"></a>00033 <span class="keyword">const</span> <span class="keywordtype">double</span> PhysicalLayer::m_RADIO_NOISE_FACTOR = 10;
<a name="l00034"></a>00034 <span class="keyword">const</span> <span class="keywordtype">double</span> PhysicalLayer::m_BOLTZMANNS_CONSTANT = 1.3806503e-23;
<a name="l00035"></a>00035 
<a name="l00036"></a>00036 <span class="keyword">const</span> <a class="code" href="utility_8hpp.html#b393a696e0318c8ab53ae2a1592e3770">t_uint</a> PhysicalLayer::m_PHYSICAL_QUEUE_LENGTH = 1;
<a name="l00037"></a>00037 
<a name="l00038"></a><a class="code" href="classPhysicalLayer.html#f02d459d3518c59d54add50d7dc56549">00038</a> <a class="code" href="classPhysicalLayer.html#f02d459d3518c59d54add50d7dc56549">PhysicalLayer::PhysicalLayer</a>(NodePtr node)
<a name="l00039"></a>00039    : <a class="code" href="classCommunicationLayer.html">CommunicationLayer</a>(node),
<a name="l00040"></a>00040    m_currentTxPower(m_DEFAULT_TX_POWER),
<a name="l00041"></a>00041    m_maxTxPower(m_DEFAULT_MAX_TX_POWER),
<a name="l00042"></a>00042    m_rxThreshold(m_DEFAULT_RX_THRESHOLD),
<a name="l00043"></a>00043    m_csThreshold(m_DEFAULT_CS_THRESHOLD),
<a name="l00044"></a>00044    m_captureThreshold(m_DEFAULT_CAPTURE_THRESHOLD),
<a name="l00045"></a>00045    m_minimumSignalStrength(m_DEFAULT_MINIMUM_SIGNAL_STRENGTH),
<a name="l00046"></a>00046    m_dataRate(m_DEFAULT_DATA_RATE),
<a name="l00047"></a>00047    m_bandwidth(m_DEFAULT_BANDWIDTH),
<a name="l00048"></a>00048    m_pendingRecvSignalError(false),
<a name="l00049"></a>00049    m_signalSendingDelay(0.0)
<a name="l00050"></a>00050 {
<a name="l00051"></a>00051    assert(m_dataRate &gt; 0.0);
<a name="l00052"></a>00052    assert(m_bandwidth &gt; 0.0);
<a name="l00053"></a>00053    assert(m_currentTxPower &gt; 0.0);
<a name="l00054"></a>00054    assert(m_maxTxPower &gt;= m_currentTxPower);
<a name="l00055"></a>00055    <a class="code" href="classCommunicationLayer.html#857d6b46cce18e15099a4eaa7246176a">setMaxQueueLength</a>(m_PHYSICAL_QUEUE_LENGTH);
<a name="l00056"></a>00056    DummyEventPtr dummyEvent = <a class="code" href="classDummyEvent.html#7b0d8f4994c70e01968626105257c6c6">DummyEvent::create</a>();
<a name="l00057"></a>00057    m_transmittingTimer = <a class="code" href="classTimer.html#1cd798163c2144aff0172a0c09d712ba">Timer::create</a>(<a class="code" href="classCommunicationLayer.html#39c60778d7fb9f62cda84eae80bf0395">getNode</a>(), dummyEvent);
<a name="l00058"></a>00058 }
<a name="l00059"></a>00059 
<a name="l00060"></a><a class="code" href="classPhysicalLayer.html#4cc84a8d4418797e725154786a785ef4">00060</a> <a class="code" href="classPhysicalLayer.html#4cc84a8d4418797e725154786a785ef4">PhysicalLayer::~PhysicalLayer</a>()
<a name="l00061"></a>00061 {
<a name="l00062"></a>00062 
<a name="l00063"></a>00063 }
<a name="l00064"></a>00064 
<a name="l00065"></a><a class="code" href="classPhysicalLayer.html#e316791d423861629bcb92a45ee0dfb9">00065</a> <span class="keywordtype">bool</span> <a class="code" href="classPhysicalLayer.html#e316791d423861629bcb92a45ee0dfb9">PhysicalLayer::recvPendingSignal</a>(WirelessCommSignalPtr signal, 
<a name="l00066"></a>00066    <span class="keywordtype">double</span> recvdSignalStrength)
<a name="l00067"></a>00067 {
<a name="l00068"></a>00068    <span class="comment">// By default, just pass the signals packet on to the</span>
<a name="l00069"></a>00069    <span class="comment">// default upper layer if it's not in error.</span>
<a name="l00070"></a>00070    <span class="keywordtype">bool</span> wasSuccessful = <span class="keyword">true</span>;
<a name="l00071"></a>00071    PacketPtr packet = signal-&gt;getPacketPtr();
<a name="l00072"></a>00072    packet-&gt;setHasError(m_pendingRecvSignalError);
<a name="l00073"></a>00073    <a class="code" href="classLogStreamManager.html#0fdcc09a0156011d2e1f85d8cfeee4ea">LogStreamManager::instance</a>()-&gt;<a class="code" href="classLogStreamManager.html#28551c81d5832eda393db1235a810cfa">logPktRecvItem</a>(<a class="code" href="classCommunicationLayer.html#5a5bf986675df016c3aa8817868ed787">getNodeId</a>(),
<a name="l00074"></a>00074       <a class="code" href="classPhysicalLayer.html#6bb17b6ee633bea231bdd35f9e668587">getLayerType</a>(), *packet);
<a name="l00075"></a>00075    <span class="keywordflow">if</span>(!packet-&gt;getHasError()) {
<a name="l00076"></a>00076       <a class="code" href="classPhysicalLayer.html#da8f7573bc3b656dcba72f555d3e9cda">recvdErrorFreeSignal</a>(signal, recvdSignalStrength);
<a name="l00077"></a>00077       wasSuccessful = <a class="code" href="classCommunicationLayer.html#85034666eb2f18a65bf4089f9a93fee9">sendToLayer</a>(
<a name="l00078"></a>00078          <a class="code" href="classCommunicationLayer.html#5076652ba2dc2a5f8c0b912baa2e91272ee130c439543c6b244d33b8745c6741">CommunicationLayer::Directions_Upper</a>, packet);
<a name="l00079"></a>00079    }
<a name="l00080"></a>00080 
<a name="l00081"></a>00081    <span class="keywordflow">return</span> wasSuccessful;
<a name="l00082"></a>00082 }
<a name="l00083"></a>00083 
<a name="l00084"></a><a class="code" href="classPhysicalLayer.html#da8f7573bc3b656dcba72f555d3e9cda">00084</a> <span class="keywordtype">void</span> <a class="code" href="classPhysicalLayer.html#da8f7573bc3b656dcba72f555d3e9cda">PhysicalLayer::recvdErrorFreeSignal</a>(WirelessCommSignalPtr signal,
<a name="l00085"></a>00085    <span class="keywordtype">double</span> recvdSignalStrength)
<a name="l00086"></a>00086 {
<a name="l00087"></a>00087 
<a name="l00088"></a>00088 }
<a name="l00089"></a>00089 
<a name="l00090"></a><a class="code" href="classPhysicalLayer.html#8b73c1305c681ec28abb81867694dc7a">00090</a> <span class="keywordtype">bool</span> <a class="code" href="classPhysicalLayer.html#8b73c1305c681ec28abb81867694dc7a">PhysicalLayer::recvFromLayer</a>(
<a name="l00091"></a>00091    <a class="code" href="classCommunicationLayer.html#5076652ba2dc2a5f8c0b912baa2e9127">CommunicationLayer::Directions</a> direction,
<a name="l00092"></a>00092    PacketPtr packet, <a class="code" href="utility_8hpp.html#b393a696e0318c8ab53ae2a1592e3770">t_uint</a> sendingLayerIdx)
<a name="l00093"></a>00093 {
<a name="l00094"></a>00094    <span class="comment">// The physical layer should not have a lower communication</span>
<a name="l00095"></a>00095    <span class="comment">// layer from which to receive.  Its lower layer is a channel</span>
<a name="l00096"></a>00096    <span class="comment">// which is not a CommunicationLayer subclass.</span>
<a name="l00097"></a>00097    assert(direction == <a class="code" href="classCommunicationLayer.html#5076652ba2dc2a5f8c0b912baa2e91272ee130c439543c6b244d33b8745c6741">CommunicationLayer::Directions_Upper</a>);
<a name="l00098"></a>00098    assert(<a class="code" href="classCommunicationLayer.html#39c60778d7fb9f62cda84eae80bf0395">getNode</a>().get() != 0);
<a name="l00099"></a>00099    <a class="code" href="classLocation.html">Location</a> myLocation = <a class="code" href="classCommunicationLayer.html#39c60778d7fb9f62cda84eae80bf0395">getNode</a>()-&gt;getLocation();
<a name="l00100"></a>00100    packet-&gt;setDataRate(<a class="code" href="classPhysicalLayer.html#b0e19bc0240be005415f32f225acb97b">getDataRate</a>());
<a name="l00101"></a>00101 
<a name="l00102"></a>00102    <span class="keywordtype">double</span> signalTxPower = m_currentTxPower;
<a name="l00103"></a>00103    <span class="keywordflow">if</span>(packet-&gt;getDoMaxTxPower()) {
<a name="l00104"></a>00104       signalTxPower = m_maxTxPower;
<a name="l00105"></a>00105    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(packet-&gt;getTxPower() &gt; 0.0) {
<a name="l00106"></a>00106       signalTxPower = packet-&gt;getTxPower();
<a name="l00107"></a>00107    }
<a name="l00108"></a>00108 
<a name="l00109"></a>00109    <span class="keywordflow">if</span>(m_DEBUG_TRANSMIT_POWER) {
<a name="l00110"></a>00110       ostringstream debugStream;
<a name="l00111"></a>00111       debugStream &lt;&lt; __PRETTY_FUNCTION__ &lt;&lt; <span class="stringliteral">": txPower: "</span> &lt;&lt;
<a name="l00112"></a>00112          signalTxPower;
<a name="l00113"></a>00113       <a class="code" href="classLogStreamManager.html#0fdcc09a0156011d2e1f85d8cfeee4ea">LogStreamManager::instance</a>()-&gt;<a class="code" href="classLogStreamManager.html#d3a8ead838e88af11940188c67a37dba">logDebugItem</a>(debugStream.str());
<a name="l00114"></a>00114    }
<a name="l00115"></a>00115 
<a name="l00116"></a>00116    WirelessCommSignalPtr signal = 
<a name="l00117"></a>00117       <a class="code" href="classWirelessCommSignal.html#59b55b6191a9188b2cfa0cb58982b201">WirelessCommSignal::create</a>(myLocation, 
<a name="l00118"></a>00118       <a class="code" href="utility_8hpp.html#5a6d9dd7000e7af2d1b9d4d3204f8fd3">powerToDecibels</a>(signalTxPower), 
<a name="l00119"></a>00119       <a class="code" href="classPhysicalLayer.html#db93819a1d019894935ea48905ee5cdb">getWavelength</a>(), <a class="code" href="classPhysicalLayer.html#1ea165fa472a02b81c99128d56a589ef">getGain</a>(), packet);
<a name="l00120"></a>00120    <span class="keywordflow">return</span> <a class="code" href="classPhysicalLayer.html#3201656dc23f8a83b6ca3622007b73d9">sendSignal</a>(signal);
<a name="l00121"></a>00121 }
<a name="l00122"></a>00122 
<a name="l00123"></a><a class="code" href="classPhysicalLayer.html#cad4fc7a1f16b54fa004d9772b488962">00123</a> <span class="keywordtype">bool</span> <a class="code" href="classPhysicalLayer.html#cad4fc7a1f16b54fa004d9772b488962">PhysicalLayer::isTransmitting</a>()<span class="keyword"> const</span>
<a name="l00124"></a>00124 <span class="keyword"></span>{
<a name="l00125"></a>00125    assert(m_transmittingTimer.get() != 0);
<a name="l00126"></a>00126    <span class="keywordflow">return</span> m_transmittingTimer-&gt;isRunning();
<a name="l00127"></a>00127 }
<a name="l00128"></a>00128 
<a name="l00129"></a><a class="code" href="classPhysicalLayer.html#3201656dc23f8a83b6ca3622007b73d9">00129</a> <span class="keywordtype">bool</span> <a class="code" href="classPhysicalLayer.html#3201656dc23f8a83b6ca3622007b73d9">PhysicalLayer::sendSignal</a>(WirelessCommSignalPtr signal)
<a name="l00130"></a>00130 {
<a name="l00131"></a>00131    <span class="keywordflow">return</span> <a class="code" href="classPhysicalLayer.html#7bfb37cf5946fd19ab3a7b427d669d6f">scheduleSignal</a>(signal);
<a name="l00132"></a>00132 }
<a name="l00133"></a>00133 
<a name="l00134"></a><a class="code" href="classPhysicalLayer.html#7bfb37cf5946fd19ab3a7b427d669d6f">00134</a> <span class="keywordtype">bool</span> <a class="code" href="classPhysicalLayer.html#7bfb37cf5946fd19ab3a7b427d669d6f">PhysicalLayer::scheduleSignal</a>(WirelessCommSignalPtr signal)
<a name="l00135"></a>00135 {
<a name="l00136"></a>00136    EventPtr recvEvent(<span class="keyword">new</span> <a class="code" href="classPhysicalLayer.html#75f7479a0ce569054bd69df7cfba42e2">SignalRecvEvent</a>(<a class="code" href="classPhysicalLayer.html#031abbc442181073fba1818bce576873">m_wirelessChannelManagerPtr</a>,
<a name="l00137"></a>00137       <a class="code" href="classPhysicalLayer.html#c9bc7a479ec06eb05894d6b24a6c6f33">thisPhysicalLayer</a>(), signal));
<a name="l00138"></a>00138    assert(<a class="code" href="classCommunicationLayer.html#39c60778d7fb9f62cda84eae80bf0395">getNode</a>().get() != 0);
<a name="l00139"></a>00139    <span class="keywordtype">bool</span> wasScheduled = <a class="code" href="classCommunicationLayer.html#39c60778d7fb9f62cda84eae80bf0395">getNode</a>()-&gt;scheduleEvent(recvEvent, 
<a name="l00140"></a>00140       <a class="code" href="classPhysicalLayer.html#fd364286f9bc1882b48bb810b6fa7503">getSignalSendingDelay</a>());
<a name="l00141"></a>00141    <span class="keywordflow">return</span> wasScheduled;
<a name="l00142"></a>00142 }
<a name="l00143"></a>00143 
<a name="l00144"></a><a class="code" href="classPhysicalLayer.html#d60020ca7c16de6a08ddcc60b2efc9c0">00144</a> <span class="keywordtype">void</span> <a class="code" href="classPhysicalLayer.html#d60020ca7c16de6a08ddcc60b2efc9c0">PhysicalLayer::addSignal</a>(WirelessCommSignalPtr signal, 
<a name="l00145"></a>00145    <span class="keywordtype">double</span> signalStrength)
<a name="l00146"></a>00146 {
<a name="l00147"></a>00147    <span class="keywordflow">if</span>(signalStrength &gt; <a class="code" href="classPhysicalLayer.html#3b5c93b27429f92837c1ab96fcf44b29">getMinimumSignalStrength</a>()) {
<a name="l00148"></a>00148       assert(signal.get() != 0);
<a name="l00149"></a>00149       SignalStrengthMap::const_iterator mapIterator = 
<a name="l00150"></a>00150          m_signalStrengths.find(signal);
<a name="l00151"></a>00151       
<a name="l00152"></a>00152       <span class="keywordtype">bool</span> wasFound = (mapIterator != m_signalStrengths.end());
<a name="l00153"></a>00153       <span class="keywordflow">if</span>(wasFound) {
<a name="l00154"></a>00154          <span class="comment">// We replace the existing signal strength with a new</span>
<a name="l00155"></a>00155          <span class="comment">// signal strength.</span>
<a name="l00156"></a>00156          m_signalStrengths.erase(signal);
<a name="l00157"></a>00157       }
<a name="l00158"></a>00158    
<a name="l00159"></a>00159       m_signalStrengths.insert(make_pair(signal, signalStrength));
<a name="l00160"></a>00160    }
<a name="l00161"></a>00161 }
<a name="l00162"></a>00162 
<a name="l00163"></a><a class="code" href="classPhysicalLayer.html#3121ad16184a8da1d7efda14480c5e53">00163</a> <span class="keywordtype">void</span> <a class="code" href="classPhysicalLayer.html#3121ad16184a8da1d7efda14480c5e53">PhysicalLayer::removeSignal</a>(WirelessCommSignalPtr signal)
<a name="l00164"></a>00164 {
<a name="l00165"></a>00165    assert(signal.get() != 0);
<a name="l00166"></a>00166    m_signalStrengths.erase(signal);
<a name="l00167"></a>00167    <span class="comment">//int numErased = m_signalStrengths.erase(signal);</span>
<a name="l00168"></a>00168    <span class="comment">//bool wasRemoved = (numErased &gt; 0);</span>
<a name="l00169"></a>00169 }
<a name="l00170"></a>00170 
<a name="l00171"></a><a class="code" href="classPhysicalLayer.html#d8b6fc811791c0035685687de242b8b7">00171</a> <span class="keywordtype">double</span> <a class="code" href="classPhysicalLayer.html#d8b6fc811791c0035685687de242b8b7">PhysicalLayer::getPendingSignalSinr</a>()
<a name="l00172"></a>00172 {
<a name="l00173"></a>00173    <span class="comment">// This is similar to the captureSignal function except</span>
<a name="l00174"></a>00174    <span class="comment">// that the signal strength in consideration, that of the</span>
<a name="l00175"></a>00175    <span class="comment">// pending signal, is already included in the culmulative</span>
<a name="l00176"></a>00176    <span class="comment">// signal strength.  So, we need to subtract that signal</span>
<a name="l00177"></a>00177    <span class="comment">// strength out of the culmulative signal strength and</span>
<a name="l00178"></a>00178    <span class="comment">// use it for the numerator.  </span>
<a name="l00179"></a>00179    <span class="keywordtype">double</span> sinr = 0.0;
<a name="l00180"></a>00180    <span class="keywordflow">if</span>(m_pendingRecvSignal.get() != 0) {
<a name="l00181"></a>00181       <span class="keywordtype">double</span> pendingSignalStrength = <a class="code" href="classPhysicalLayer.html#e6370bde18a9a21488d8b482adb09d9b">getPendingSignalStrength</a>();
<a name="l00182"></a>00182       <span class="keywordtype">double</span> interferenceFloor =
<a name="l00183"></a>00183          (<a class="code" href="classPhysicalLayer.html#8abef29ab25bd26f5800e29d6e739682">getCulmulativeSignalStrength</a>() - pendingSignalStrength) + 
<a name="l00184"></a>00184          <a class="code" href="classPhysicalLayer.html#f2510cb4ea8b5b400831f1d6ee754f0f">getNoiseFloor</a>();
<a name="l00185"></a>00185       sinr = pendingSignalStrength / interferenceFloor;
<a name="l00186"></a>00186    }
<a name="l00187"></a>00187    <span class="keywordflow">return</span> sinr;
<a name="l00188"></a>00188 }
<a name="l00189"></a>00189 
<a name="l00190"></a><a class="code" href="classPhysicalLayer.html#5b50bae0901964f6e150552b4289d3f9">00190</a> <span class="keywordtype">bool</span> <a class="code" href="classPhysicalLayer.html#5b50bae0901964f6e150552b4289d3f9">PhysicalLayer::pendingSignalIsWeak</a>()
<a name="l00191"></a>00191 {
<a name="l00192"></a>00192    <span class="comment">// Note that this function returns</span>
<a name="l00193"></a>00193    <span class="comment">// true if the signal is too weak, whereas captureSignal</span>
<a name="l00194"></a>00194    <span class="comment">// returns true if the signal is sufficiently strong.</span>
<a name="l00195"></a>00195    <span class="keywordtype">bool</span> isWeak = (<a class="code" href="classPhysicalLayer.html#e6370bde18a9a21488d8b482adb09d9b">getPendingSignalStrength</a>() &lt;= <a class="code" href="classPhysicalLayer.html#4fc39d541f286f8b5bb797922b645d11">getRxThreshold</a>());
<a name="l00196"></a>00196    <span class="keywordflow">if</span>(m_pendingRecvSignal.get() != 0) {
<a name="l00197"></a>00197       isWeak |= (<a class="code" href="classPhysicalLayer.html#d8b6fc811791c0035685687de242b8b7">getPendingSignalSinr</a>() &lt;= <a class="code" href="classPhysicalLayer.html#6f32a0aacbdf51396b94eb4ee73e5fff">getCaptureThreshold</a>());
<a name="l00198"></a>00198    }
<a name="l00199"></a>00199    <span class="keywordflow">return</span> isWeak;
<a name="l00200"></a>00200 }
<a name="l00201"></a>00201 
<a name="l00202"></a><a class="code" href="classPhysicalLayer.html#06f60afa6a53f974fc3233d4f9e24173">00202</a> <span class="keywordtype">bool</span> <a class="code" href="classPhysicalLayer.html#06f60afa6a53f974fc3233d4f9e24173">PhysicalLayer::captureSignal</a>(<span class="keywordtype">double</span> signalStrength)<span class="keyword"> const</span>
<a name="l00203"></a>00203 <span class="keyword"></span>{
<a name="l00204"></a>00204    <span class="keywordtype">bool</span> isSufficientlyStrong = (signalStrength &gt; <a class="code" href="classPhysicalLayer.html#4fc39d541f286f8b5bb797922b645d11">getRxThreshold</a>());
<a name="l00205"></a>00205 
<a name="l00206"></a>00206    <span class="keywordflow">if</span>(isSufficientlyStrong) {
<a name="l00207"></a>00207       <span class="keywordtype">double</span> interferenceFloor = <a class="code" href="classPhysicalLayer.html#8abef29ab25bd26f5800e29d6e739682">getCulmulativeSignalStrength</a>() + 
<a name="l00208"></a>00208          <a class="code" href="classPhysicalLayer.html#f2510cb4ea8b5b400831f1d6ee754f0f">getNoiseFloor</a>();
<a name="l00209"></a>00209       <span class="keywordtype">double</span> sinr = signalStrength / interferenceFloor;
<a name="l00216"></a>00216       isSufficientlyStrong &amp;= (sinr &gt; <a class="code" href="classPhysicalLayer.html#6f32a0aacbdf51396b94eb4ee73e5fff">getCaptureThreshold</a>());
<a name="l00217"></a>00217       <span class="keywordflow">if</span>(m_DEBUG_SIGNAL_CAPTURE) {
<a name="l00218"></a>00218          ostringstream debugStream;
<a name="l00219"></a>00219          debugStream &lt;&lt; __PRETTY_FUNCTION__ &lt;&lt; 
<a name="l00220"></a>00220             <span class="stringliteral">": NodeId: "</span> &lt;&lt; <a class="code" href="classCommunicationLayer.html#5a5bf986675df016c3aa8817868ed787">getNodeId</a>() &lt;&lt; 
<a name="l00221"></a>00221             <span class="stringliteral">" SINR: "</span> &lt;&lt; sinr &lt;&lt;
<a name="l00222"></a>00222             <span class="stringliteral">" SS: "</span> &lt;&lt; signalStrength &lt;&lt; 
<a name="l00223"></a>00223             <span class="stringliteral">" RxThreshold: "</span> &lt;&lt; <a class="code" href="classPhysicalLayer.html#4fc39d541f286f8b5bb797922b645d11">getRxThreshold</a>() &lt;&lt; 
<a name="l00224"></a>00224             <span class="stringliteral">" CsThreshold: "</span> &lt;&lt; <a class="code" href="classPhysicalLayer.html#e2bbabfad75920bb75fb9c4ed0b05045">getCsThreshold</a>() &lt;&lt; 
<a name="l00225"></a>00225             <span class="stringliteral">" captureThresh: "</span> &lt;&lt; <a class="code" href="classPhysicalLayer.html#6f32a0aacbdf51396b94eb4ee73e5fff">getCaptureThreshold</a>() &lt;&lt; 
<a name="l00226"></a>00226             <span class="stringliteral">" INTR: "</span> &lt;&lt; interferenceFloor &lt;&lt;
<a name="l00227"></a>00227             <span class="stringliteral">" culmulative: "</span> &lt;&lt; <a class="code" href="classPhysicalLayer.html#8abef29ab25bd26f5800e29d6e739682">getCulmulativeSignalStrength</a>() &lt;&lt;
<a name="l00228"></a>00228             <span class="stringliteral">" noise: "</span> &lt;&lt; <a class="code" href="classPhysicalLayer.html#f2510cb4ea8b5b400831f1d6ee754f0f">getNoiseFloor</a>();
<a name="l00229"></a>00229          <a class="code" href="classLogStreamManager.html#0fdcc09a0156011d2e1f85d8cfeee4ea">LogStreamManager::instance</a>()-&gt;<a class="code" href="classLogStreamManager.html#d3a8ead838e88af11940188c67a37dba">logDebugItem</a>(debugStream.str());
<a name="l00230"></a>00230       }
<a name="l00231"></a>00231    }
<a name="l00232"></a>00232    <span class="keywordflow">return</span> isSufficientlyStrong;
<a name="l00233"></a>00233 }
<a name="l00234"></a>00234 
<a name="l00235"></a><a class="code" href="classPhysicalLayer.html#8abef29ab25bd26f5800e29d6e739682">00235</a> <span class="keywordtype">double</span> <a class="code" href="classPhysicalLayer.html#8abef29ab25bd26f5800e29d6e739682">PhysicalLayer::getCulmulativeSignalStrength</a>()<span class="keyword"> const</span>
<a name="l00236"></a>00236 <span class="keyword"></span>{
<a name="l00237"></a>00237    <span class="keywordtype">double</span> culmulativeStrength = 0;
<a name="l00238"></a>00238    SignalStrengthMap::const_iterator mapIterator;
<a name="l00239"></a>00239    <span class="keywordflow">for</span>(mapIterator = m_signalStrengths.begin();
<a name="l00240"></a>00240          mapIterator != m_signalStrengths.end(); ++mapIterator) {
<a name="l00241"></a>00241       culmulativeStrength += mapIterator-&gt;second;
<a name="l00242"></a>00242    }
<a name="l00243"></a>00243    <span class="keywordflow">return</span> culmulativeStrength;
<a name="l00244"></a>00244 }
<a name="l00245"></a>00245 
<a name="l00246"></a><a class="code" href="classPhysicalLayer.html#2112ec7ca280fb6e253cac1f4ce16497">00246</a> <span class="keywordtype">void</span> <a class="code" href="classPhysicalLayer.html#2112ec7ca280fb6e253cac1f4ce16497">PhysicalLayer::setPendingSignal</a>(WirelessCommSignalPtr signal)
<a name="l00247"></a>00247 {
<a name="l00248"></a>00248    assert(signal.get() != 0);
<a name="l00249"></a>00249    m_pendingRecvSignal = signal;
<a name="l00250"></a>00250 }
<a name="l00251"></a>00251 
<a name="l00252"></a><a class="code" href="classPhysicalLayer.html#76199f0741683e3b0d3dd2c6e21730f8">00252</a> ConstWirelessCommSignalPtr <a class="code" href="classPhysicalLayer.html#76199f0741683e3b0d3dd2c6e21730f8">PhysicalLayer::getPendingSignal</a>()<span class="keyword"> const</span>
<a name="l00253"></a>00253 <span class="keyword"></span>{
<a name="l00254"></a>00254    <span class="keywordflow">return</span> m_pendingRecvSignal;
<a name="l00255"></a>00255 }
<a name="l00256"></a>00256 
<a name="l00257"></a><a class="code" href="classPhysicalLayer.html#e6370bde18a9a21488d8b482adb09d9b">00257</a> <span class="keywordtype">double</span> <a class="code" href="classPhysicalLayer.html#e6370bde18a9a21488d8b482adb09d9b">PhysicalLayer::getPendingSignalStrength</a>()
<a name="l00258"></a>00258 {
<a name="l00259"></a>00259    <span class="keywordtype">double</span> signalStrength = 0.0;
<a name="l00260"></a>00260    <span class="keywordflow">if</span>(m_pendingRecvSignal.get() != 0) {
<a name="l00261"></a>00261       SignalStrengthMap::iterator mapIterator = 
<a name="l00262"></a>00262          m_signalStrengths.find(m_pendingRecvSignal);
<a name="l00263"></a>00263    
<a name="l00264"></a>00264       <span class="keywordtype">bool</span> wasFound = (mapIterator != m_signalStrengths.end());
<a name="l00265"></a>00265       assert(wasFound);
<a name="l00266"></a>00266       signalStrength = mapIterator-&gt;second;
<a name="l00267"></a>00267    }
<a name="l00268"></a>00268 
<a name="l00269"></a>00269    <span class="keywordflow">return</span> signalStrength;
<a name="l00270"></a>00270 }
<a name="l00271"></a>00271 
<a name="l00272"></a><a class="code" href="classPhysicalLayer.html#f653514f9bc43de102b7203fed6868bf">00272</a> <span class="keywordtype">void</span> <a class="code" href="classPhysicalLayer.html#f653514f9bc43de102b7203fed6868bf">PhysicalLayer::resetPendingSignal</a>()
<a name="l00273"></a>00273 {
<a name="l00274"></a>00274    m_pendingRecvSignalError = <span class="keyword">false</span>;
<a name="l00275"></a>00275    m_pendingRecvSignal.reset();
<a name="l00276"></a>00276 }
<a name="l00277"></a>00277 
<a name="l00278"></a><a class="code" href="classPhysicalLayer.html#0fc3d10ff814adaee9b62f414706e488">00278</a> <span class="keywordtype">void</span> <a class="code" href="classPhysicalLayer.html#0fc3d10ff814adaee9b62f414706e488">PhysicalLayer::resetRecvSignals</a>()
<a name="l00279"></a>00279 {
<a name="l00280"></a>00280    <a class="code" href="classPhysicalLayer.html#f653514f9bc43de102b7203fed6868bf">resetPendingSignal</a>();
<a name="l00281"></a>00281    m_signalStrengths.empty();
<a name="l00282"></a>00282 }
<a name="l00283"></a>00283 
<a name="l00284"></a><a class="code" href="classPhysicalLayer.html#fb7587ad33a36082d1fe1234d1757684">00284</a> <span class="keywordtype">bool</span> <a class="code" href="classPhysicalLayer.html#fb7587ad33a36082d1fe1234d1757684">PhysicalLayer::channelCarrierSensedBusy</a>()<span class="keyword"> const</span>
<a name="l00285"></a>00285 <span class="keyword"></span>{
<a name="l00286"></a>00286    <span class="keywordtype">bool</span> isBusy = (<a class="code" href="classPhysicalLayer.html#8abef29ab25bd26f5800e29d6e739682">getCulmulativeSignalStrength</a>() &gt; <a class="code" href="classPhysicalLayer.html#e2bbabfad75920bb75fb9c4ed0b05045">getCsThreshold</a>());
<a name="l00287"></a>00287    <span class="keywordflow">return</span> isBusy;
<a name="l00288"></a>00288 }
<a name="l00289"></a>00289 
<a name="l00290"></a><a class="code" href="classPhysicalLayer.html#2feac1ad84432e383fe6db969ae8374b">00290</a> <a class="code" href="classLocation.html">Location</a> <a class="code" href="classPhysicalLayer.html#2feac1ad84432e383fe6db969ae8374b">PhysicalLayer::getLocation</a>()<span class="keyword"> const</span>
<a name="l00291"></a>00291 <span class="keyword"></span>{
<a name="l00292"></a>00292    <span class="keywordflow">return</span> <a class="code" href="classCommunicationLayer.html#39c60778d7fb9f62cda84eae80bf0395">getNode</a>()-&gt;getLocation();
<a name="l00293"></a>00293 }
<a name="l00294"></a>00294 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Dec 12 17:04:38 2006 for rfidsim by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
